{"version":3,"file":"CanvasEqualizer.cjs.js","sources":["../../src/ts/Common.ts","../../src/ts/FFTNR.ts","../../src/ts/Equalizer.ts","../../src/ts/L10n.ts","../../src/ts/CanvasEqualizer.ts","../../src/ts/index.ts"],"sourcesContent":["/**\n * canvas-equalizer is distributed under the FreeBSD License\n *\n * Copyright (c) 2012-2017 Armando Meziat, Carlos Rafael Gimenes das Neves\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * The views and conclusions contained in the software and documentation are those\n * of the authors and should not be interpreted as representing official policies,\n * either expressed or implied, of the FreeBSD Project.\n *\n * https://github.com/radiojhero/canvas-equalizer\n */\n\n// miscellaneous functions\n\n(function (window: Window) {\n    try {\n        new CustomEvent('test');\n    }\n    catch (e) {\n        return; // no need to polyfill\n    }\n\n    // polyfills DOM4 CustomEvent\n    function MouseEvent(eventType: string, params: MouseEventInit) {\n        params = params || { bubbles: false, cancelable: false };\n        const mouseEvent = document.createEvent('MouseEvent');\n        mouseEvent.initMouseEvent(eventType, params.bubbles!, params.cancelable!, window, 1,\n                                  params.screenX!, params.screenY!, params.clientX!, params.clientY!,\n                                  params.ctrlKey!, params.altKey!, params.shiftKey!, params.metaKey!,\n                                  0, null);\n\n        return mouseEvent;\n    }\n\n    MouseEvent.prototype = Event.prototype;\n\n    (window as any).MouseEvent = MouseEvent;\n})(window);\n\ntype PointerEventShortName = 'down' | 'move' | 'up';\ntype AttachDetachSignature = (observable: EventTarget, eventName: PointerEventShortName,\n                              targetFunction: (e: MouseEvent) => any, capturePhase?: boolean) => void;\n\nlet attachPointer: AttachDetachSignature;\nlet detachPointer: AttachDetachSignature;\n\nfunction wrap(func: any, wrapper: any, tag: string, elem: EventTarget): any {\n    const wrapperTag = `__${tag}_wrapper__`;\n\n    if (!func[wrapperTag]) {\n        func[wrapperTag] = [];\n    }\n\n    unwrap(func, tag, elem);\n    func[wrapperTag].push({ elem, wrapper });\n    return wrapper;\n}\n\nfunction unwrap(func: any, tag: string, elem: EventTarget): any {\n    const wrapperTag = `__${tag}_wrapper__`;\n\n    let ret: any;\n\n    if (func[wrapperTag]) {\n        func[wrapperTag] = func[wrapperTag].filter((entry: { elem: EventTarget, wrapper: any }, i: number) => {\n            if (entry.elem === elem) {\n                ret = entry.wrapper;\n                return false;\n            }\n\n            return true;\n        });\n    }\n\n    return ret;\n}\n\nif ((window as any).PointerEvent) {\n    attachPointer = function (observable: EventTarget, eventName: PointerEventShortName,\n                              targetFunction: (e: MouseEvent) => any, capturePhase?: boolean) {\n        observable.addEventListener(`pointer${eventName}`, targetFunction as EventListener, capturePhase);\n    };\n    detachPointer = function (observable: EventTarget, eventName: PointerEventShortName,\n                              targetFunction: (e: MouseEvent) => any, capturePhase?: boolean) {\n        observable.removeEventListener(`pointer${eventName}`, targetFunction as EventListener, capturePhase);\n    };\n}\nelse if ('ontouchend' in document) {\n    const mappings: any = {\n        down: ['start'],\n        move: ['move'],\n        up: ['end', 'cancel'],\n    };\n    attachPointer = function (observable: EventTarget, eventName: PointerEventShortName,\n                              targetFunction: (e: MouseEvent) => any, capturePhase?: boolean) {\n        const wrapper = (e: TouchEvent) => {\n            const touch = e.changedTouches[0];\n            const pseudoMouse = new MouseEvent(`mouse${eventName}`, {\n                altKey: e.altKey,\n                clientX: touch && touch.clientX || 0,\n                clientY: touch && touch.clientY || 0,\n                ctrlKey: e.ctrlKey,\n                metaKey: e.metaKey,\n                screenX: touch && touch.screenX || 0,\n                screenY: touch && touch.screenY || 0,\n                shiftKey: e.shiftKey,\n            });\n\n            (pseudoMouse as any).clonedFromTouch = true;\n\n            const result = targetFunction(pseudoMouse);\n\n            if (result === false || pseudoMouse.defaultPrevented) {\n                cancelEvent(e);\n            }\n\n            return result;\n        };\n\n        mappings[eventName].forEach((mapping: string) => {\n            observable.addEventListener(`touch${mapping}`,\n                wrap(targetFunction, wrapper, `touch${eventName}`, observable), capturePhase);\n        });\n    };\n    detachPointer = function (observable: EventTarget, eventName: PointerEventShortName,\n                              targetFunction: (e: MouseEvent) => any, capturePhase?: boolean) {\n        mappings[eventName].forEach((mapping: string) => {\n            observable.removeEventListener(`touch${mapping}`,\n                unwrap(targetFunction, `touch${eventName}`, observable), capturePhase);\n        });\n    };\n}\nelse {\n    attachPointer = function (observable: EventTarget, eventName: PointerEventShortName,\n                              targetFunction: (e: MouseEvent) => any, capturePhase?: boolean) {\n        observable.addEventListener(`mouse${eventName}`, targetFunction as EventListener, capturePhase);\n    };\n    detachPointer = function (observable: EventTarget, eventName: PointerEventShortName,\n                              targetFunction: (e: MouseEvent) => any, capturePhase?: boolean) {\n        observable.removeEventListener(`mouse${eventName}`, targetFunction as EventListener, capturePhase);\n    };\n}\n\nconst runningFuncs: (() => void)[] = [];\n\nexport { attachPointer, detachPointer };\n\n/* tslint:disable:no-magic-numbers object-literal-sort-keys */\nexport const keyFix: any = {\n    Backspace: 8,\n    '\\t': ['Tab', 9],\n    '\\n': ['Enter', 13],\n    Escape: 27,\n    End: 35,\n    Home: 36,\n    ArrowLeft: 37,\n    ArrowUp: 38,\n    ArrowRight: 39,\n    ArrowDown: 40,\n    Delete: 46,\n};\n/* tslint:enable:no-magic-numbers object-literal-sort-keys */\n\nexport function keyPressed(e: KeyboardEvent, ...chars: string[]) {\n    for (let i = 0; i < chars.length; i++) {\n        const chr = chars[i];\n        if (Object.keys(keyFix).indexOf(chr) !== -1) {\n            const [key, keyCode] = Array.isArray(keyFix[chr]) ? keyFix[chr] : [chr, keyFix[chr]];\n            if (e.key === key || e.keyCode === keyCode) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\nexport function cancelEvent(e: Event) {\n    e.preventDefault();\n    e.stopPropagation();\n    return false;\n}\n\nexport function throttledFunction(func: () => void, timeout?: number) {\n    if (runningFuncs.indexOf(func) === -1) {\n        runningFuncs.push(func);\n        const wrapper = () => {\n            func();\n            runningFuncs.splice(runningFuncs.indexOf(func), 1);\n        };\n\n        if (timeout) {\n            setTimeout(wrapper, timeout);\n        }\n        else {\n            requestAnimationFrame(wrapper);\n        }\n    }\n}\n\nexport function addThrottledEvent(observable: EventTarget,\n                                  eventName: string,\n                                  targetFunction: (e?: Event) => any,\n                                  capturePhase?: boolean) {\n    let running = false;\n    const wrapper = (e: Event) => {\n        if (!running) {\n            running = true;\n            requestAnimationFrame(() => {\n                targetFunction(e);\n                running = false;\n            });\n        }\n    };\n\n    observable.addEventListener(eventName,\n        wrap(targetFunction, wrapper, `throttle${eventName}`, observable), capturePhase);\n}\n\nexport function removeThrottledEvent(observable: EventTarget,\n                                     eventName: string,\n                                     targetFunction: (e?: Event) => any,\n                                     capturePhase?: boolean) {\n    observable.removeEventListener(eventName,\n        unwrap(targetFunction, `throttle${eventName}`, observable), capturePhase);\n}\n\nexport function elemCoords(elem: HTMLElement, e: MouseEvent): { x: number, y: number } {\n    const rect = elem.getBoundingClientRect();\n    return {\n        x: e.clientX - rect.left,\n        y: e.clientY - rect.top,\n    };\n}\n","/**\n * canvas-equalizer is distributed under the FreeBSD License\n *\n * Copyright (c) 2012-2017 Armando Meziat, Carlos Rafael Gimenes das Neves\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * The views and conclusions contained in the software and documentation are those\n * of the authors and should not be interpreted as representing official policies,\n * either expressed or implied, of the FreeBSD Project.\n *\n * https://github.com/radiojhero/canvas-equalizer\n */\n\n/*==============================================================================\n *\n * This algorithm is an adaptation of the algorithm from the hardcover\n * book \"Numerical Recipes: The Art of Scientific Computing, 3rd Edition\",\n * with some additional optimizations and changes.\n *\n * I HIGHLY recommend this book!!! :D\n *\n *==============================================================================\n */\n\n/* Ordering of data\n * time [0]          | Real [bin 0]\n * time [1]          | Real [bin length/2]\n * time [2]          | Real [bin 1]\n * time [3]          | Imag [bin 1]\n * time [...]        | Real [bin ...]\n * time [...]        | Imag [bin ...]\n * time [length-2]   | Real [bin length/2-1]\n * time [length-1]   | Imag [bin length/2-1]\n */\n\n/* tslint:disable:no-magic-numbers no-bitwise */\n\nexport function FFTComplex(data: Float32Array, n: number, isign: number) {\n    const nn = n << 1;\n    let mmax: number;\n    let m: number;\n    let j = 1;\n    let istep: number;\n    let i: number;\n    let wr: number;\n    let wpr: number;\n    let wpi: number;\n    let wi: number;\n    let theta: number;\n    let tempr: number;\n    let tempi: number;\n    let halfmmax: number;\n    let dj1: number;\n    let dj: number;\n\n    // bit reversal swap\n    for (i = 1; i < nn; i += 2) {\n        if (j > i) {\n            tempr = data[j - 1];\n            data[j - 1] = data[i - 1];\n            data[i - 1] = tempr;\n            tempr = data[j];\n            data[j] = data[i];\n            data[i] = tempr;\n        }\n\n        m = n;\n\n        while (m >= 2 && j > m) {\n            j -= m;\n            m >>>= 1;\n        }\n\n        j += m;\n    }\n\n    // first pass (mmax = 2 / wr = 1 / wi = 0)\n    for (i = 1; i <= nn; i += 4) {\n        j = i + 2;\n        tempr = data[j - 1];\n        tempi = data[j];\n        data[j - 1] = data[i - 1] - tempr;\n        data[j] = data[i] - tempi;\n        data[i - 1] += tempr;\n        data[i] += tempi;\n    }\n\n    /* I decided not to unroll the following steps in favor of the cache memory\n\n    // second pass (mmax = 4 / wr = 1 / wi = 0) A\n    for (i = 1; i <= nn; i += 8) {\n        j = i + 4;\n        tempr = data[j - 1];\n        tempi = data[j];\n        data[j - 1] = data[i - 1] - tempr;\n        data[j] = data[i] - tempi;\n        data[i - 1] += tempr;\n        data[i] += tempi;\n    }\n\n    // second pass (mmax = 4 / wr = 0 / wi = isign) B\n    if (isign === 1) {\n        for (i = 3; i <= nn; i += 8) {\n            j = i + 4;\n            tempr = -data[j];\n            tempi = data[j - 1];\n            data[j - 1] = data[i - 1] - tempr;\n            data[j] = data[i] - tempi;\n            data[i - 1] += tempr;\n            data[i] += tempi;\n        }\n    }\n    else {\n        for (i = 3; i <= nn; i += 8) {\n            j = i + 4;\n            tempr = data[j];\n            tempi = -data[j - 1];\n            data[j - 1] = data[i - 1] - tempr;\n            data[j] = data[i] - tempi;\n            data[i - 1] += tempr;\n            data[i] += tempi;\n        }\n    }\n\n    mmax = 8;\n    theta = isign * Math.PI * 0.25;\n    */\n\n    mmax = 4;\n    theta = isign * Math.PI * 0.5;\n\n    while (nn > mmax) {\n        istep = mmax << 1;\n        wpi = Math.sin(theta);\n        theta *= 0.5;\n        wpr = Math.sin(theta);\n        wpr *= -2.0 * wpr;\n\n        // ---------------------------------------------\n        // special case for the inner loop when m = 1:\n        // wr = 1 / wi = 0\n        for (i = 1; i <= nn; i += istep) {\n            j = i + mmax;\n            tempr = data[j - 1];\n            tempi = data[j];\n            data[j - 1] = data[i - 1] - tempr;\n            data[j] = data[i] - tempi;\n            data[i - 1] += tempr;\n            data[i] += tempi;\n        }\n\n        wr = 1.0 + wpr;\n        wi = wpi;\n        // ---------------------------------------------\n\n        halfmmax = ((mmax >>> 1) + 1);\n\n        for (m = 3; m < halfmmax; m += 2) {\n            for (i = m; i <= nn; i += istep) {\n                j = i + mmax;\n                tempr = (wr * (dj1 = data[j - 1])) - (wi * (dj = data[j]));\n                tempi = (wr * dj) + (wi * dj1);\n                data[j - 1] = data[i - 1] - tempr;\n                data[j] = data[i] - tempi;\n                data[i - 1] += tempr;\n                data[i] += tempi;\n            }\n            wr += ((tempr = wr) * wpr) - (wi * wpi);\n            wi += (wi * wpr) + (tempr * wpi);\n        }\n\n        // ---------------------------------------------\n        // special case for the inner loop when m = ((mmax >>> 1) + 1):\n        // wr = 0 / wi = isign\n        if (isign === 1) {\n            for (i = m; i <= nn; i += istep) {\n                j = i + mmax;\n                tempr = -data[j];\n                tempi = data[j - 1];\n                data[j - 1] = data[i - 1] - tempr;\n                data[j] = data[i] - tempi;\n                data[i - 1] += tempr;\n                data[i] += tempi;\n            }\n            wr = -wpi;\n            wi = 1.0 + wpr;\n        }\n        else {\n            for (i = m; i <= nn; i += istep) {\n                j = i + mmax;\n                tempr = data[j];\n                tempi = -data[j - 1];\n                data[j - 1] = data[i - 1] - tempr;\n                data[j] = data[i] - tempi;\n                data[i - 1] += tempr;\n                data[i] += tempi;\n            }\n            wr = wpi;\n            wi = -1.0 - wpr;\n        }\n\n        m += 2;\n        // ---------------------------------------------\n\n        for (; m < mmax; m += 2) {\n            for (i = m; i <= nn; i += istep) {\n                j = i + mmax;\n                tempr = (wr * (dj1 = data[j - 1])) - (wi * (dj = data[j]));\n                tempi = (wr * dj) + (wi * dj1);\n                data[j - 1] = data[i - 1] - tempr;\n                data[j] = data[i] - tempi;\n                data[i - 1] += tempr;\n                data[i] += tempi;\n            }\n            wr += ((tempr = wr) * wpr) - (wi * wpi);\n            wi += (wi * wpr) + (tempr * wpi);\n        }\n\n        mmax = istep;\n    }\n}\n\nexport function FFTReal(data: Float32Array, n: number, isign: number) {\n    let i: number;\n    let i1: number;\n    let i2: number;\n    let i3: number;\n    let i4: number;\n    let d1: number;\n    let d2: number;\n    let d3: number;\n    let d4: number;\n    const n4 = n >>> 2;\n    let c2: number;\n    let h1r: number;\n    let h1i: number;\n    let h2r: number;\n    let h2i: number;\n    let wr: number;\n    let wi: number;\n    let wpr: number;\n    let wpi: number;\n    let theta = Math.PI / (n >>> 1);\n\n    if (isign === 1) {\n        c2 = -0.5;\n        FFTComplex(data, n >>> 1, 1);\n    }\n    else {\n        c2 = 0.5;\n        theta = -theta;\n    }\n\n    wpr = Math.sin(0.5 * theta);\n    wr = 1.0 + (wpr *= (-2.0 * wpr));\n    wi = (wpi = Math.sin(theta));\n\n    for (i = 1; i < n4; i++) {\n        i2 = 1 + (i1 = (i << 1));\n        i4 = 1 + (i3 = (n - i1));\n        h1r = 0.5 * ((d1 = data[i1]) + (d3 = data[i3]));\n        h1i = 0.5 * ((d2 = data[i2]) - (d4 = data[i4]));\n        h2r = -c2 * (d2 + d4);\n        h2i = c2 * (d1 - d3);\n        data[i1] = h1r + (d1 = (wr * h2r)) - (d2 = (wi * h2i));\n        data[i2] = h1i + (d3 = (wr * h2i)) + (d4 = (wi * h2r));\n        data[i3] = h1r - d1 + d2;\n        data[i4] = d3 + d4 - h1i;\n        wr += ((h1r = wr) * wpr) - (wi * wpi);\n        wi += (wi * wpr) + (h1r * wpi);\n    }\n\n    if (isign === 1) {\n        data[0] = (h1r = data[0]) + data[1];\n        data[1] = h1r - data[1];\n    }\n    else {\n        data[0] = 0.5 * ((h1r = data[0]) + data[1]);\n        data[1] = 0.5 * (h1r - data[1]);\n        FFTComplex(data, n >>> 1, -1);\n        h1r = 2.0 / n;\n\n        for (i = n - 1; i >= 0; i--) {\n            data[i] *= h1r;\n        }\n    }\n}\n","/**\n * canvas-equalizer is distributed under the FreeBSD License\n *\n * Copyright (c) 2012-2017 Armando Meziat, Carlos Rafael Gimenes das Neves\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * The views and conclusions contained in the software and documentation are those\n * of the authors and should not be interpreted as representing official policies,\n * either expressed or implied, of the FreeBSD Project.\n *\n * https://github.com/radiojhero/canvas-equalizer\n */\n\n/* tslint:disable:no-magic-numbers no-bitwise */\n\nimport deepAssign from 'deep-assign';\nimport { FFTReal } from './FFTNR';\nimport IEqualizerOptions from './IEqualizerOptions';\n\nconst defaultOptions: IEqualizerOptions = {\n    validYRangeHeight: 255,\n    visibleBinCount: 512,\n};\n\nexport default class Equalizer {\n\n    private _options: IEqualizerOptions;\n    private _visibleFrequencies: Float32Array;\n    private _equivalentZones: Uint16Array;\n    private _equivalentZonesFrequencyCount: Float32Array;\n    private _zeroChannelValueY: number;\n    public _maximumChannelValue: number;\n    public _minimumChannelValue: number;\n    public _minusInfiniteChannelValue: number;\n    private _maximumChannelValueY: number;\n    private _minimumChannelValueY: number;\n    private _filterLength: number;\n    private _sampleRate: number;\n    private _isNormalized: boolean;\n    public _binCount: number;\n    private _audioContext: AudioContext;\n    private _filterKernel: AudioBuffer;\n    private _convolver: ConvolverNode;\n    private _tmp: Float32Array;\n    private _channelCurves: Int16Array[];\n    private _actualChannelCurve: Int16Array;\n    private _channelIndex: number;\n\n    constructor(filterLength: number, audioContext: AudioContext, options: IEqualizerOptions = {}) {\n        Equalizer._validateFilterLength(filterLength);\n\n        this._options = deepAssign({}, defaultOptions, options);\n        this._filterLength = filterLength;\n        this._sampleRate = audioContext.sampleRate || 44100;\n        this._isNormalized = false;\n        this._binCount = (filterLength >>> 1) + 1;\n        this._audioContext = audioContext;\n        this._filterKernel = audioContext.createBuffer(2, filterLength, this._sampleRate);\n        this._tmp = new Float32Array(filterLength);\n        this._channelCurves = [\n            new Int16Array(this._options.visibleBinCount!), new Int16Array(this._options.visibleBinCount!)];\n        this._actualChannelCurve = new Int16Array(this._options.visibleBinCount!);\n        this._channelIndex = -1;\n\n        this._zeroChannelValueY = this._options.validYRangeHeight! >>> 1;\n        this._maximumChannelValue = this._options.validYRangeHeight! >>> 1;\n        this._minimumChannelValue = -(this._options.validYRangeHeight! >>> 1);\n        this._minusInfiniteChannelValue = -(this._options.validYRangeHeight! >>> 1) - 1;\n        this._maximumChannelValueY = 0;\n        this._minimumChannelValueY = this._options.validYRangeHeight! - 1;\n\n        this._visibleFrequencies = new Float32Array(this._options.visibleBinCount!);\n        this._equivalentZones = new Uint16Array([31, 62, 125, 250, 500, 1000, 2000, 4000, 8000, 16000]);\n\n        /* [0, +9, +9, +18, +35, +36, +70, +72, +72, +72, visibleBinCount] */\n        let eqz = [0, 9, 18, 36, 71, 107, 177, 249, 321, 393, 512];\n        const ratio = this._options.visibleBinCount! / eqz[eqz.length - 1];\n        let freqSteps = [5, 5, 5, 5, 10, 10, 20, 40, 80, 89];\n        const firstFreqs = [5, 50, 95, 185, 360, 720, 1420, 2860, 5740, 11498];\n        let f = firstFreqs[0];\n\n        if (this._options.visibleBinCount! !== eqz[eqz.length - 1]) {\n            eqz = eqz.map((num: number) => Math.round(num * ratio));\n            freqSteps = freqSteps.map((num: number) => num / ratio);\n        }\n\n        this._equivalentZonesFrequencyCount = new Float32Array(eqz);\n\n        for (let i = 0, s = 0; i < this._options.visibleBinCount!; i++) {\n            this._visibleFrequencies[i] = f;\n            if (s !== eqz.length - 1 && s !== firstFreqs.length - 1 && i + 1 >= eqz[s + 1]) {\n                s++;\n                f = firstFreqs[s];\n            }\n            else {\n                f += freqSteps[s];\n            }\n        }\n\n        this.reset();\n        this._convolver = audioContext.createConvolver();\n        this._convolver.normalize = false;\n        this._convolver.buffer = this._filterKernel;\n    }\n\n    public reset() {\n        for (let i = this._options.visibleBinCount! - 1; i >= 0; i--) {\n            this._channelCurves[0][i] = this._zeroChannelValueY;\n            this._channelCurves[1][i] = this._zeroChannelValueY;\n            this._actualChannelCurve[i] = this._zeroChannelValueY;\n        }\n\n        this.updateFilter(true);\n        this.updateActualChannelCurve(0);\n    }\n\n    public clampY(y: number): number {\n        const maxY = this._maximumChannelValueY;\n        const minY = this._minimumChannelValueY;\n\n        return y <= maxY ? maxY : (y > minY ? this._options.validYRangeHeight! + 1 : y);\n    }\n\n    public yToDB(y: number): number {\n        const maxY = this._maximumChannelValueY;\n        const minY = this._minimumChannelValueY;\n\n        return y <= maxY ? 40 : (y > minY ? -Infinity : Equalizer._lerp(maxY, 40, minY, -40, y));\n    }\n\n    public yToMagnitude(y: number): number {\n        // 40dB = 100\n        // -40dB = 0.01\n        // magnitude = 10 ^ (dB/20)\n        // log a (x^p) = p * log a (x)\n        // x^p = a ^ (p * log a (x))\n        // 10^p = e ^ (p * log e (10))\n        const maxY = this._maximumChannelValueY;\n        const minY = this._minimumChannelValueY;\n\n        return y <= maxY ? 100 :\n            (y > minY ? 0 : Math.exp(Equalizer._lerp(maxY, 2, minY, -2, y) * Math.LN10)); // 2 = 40dB/20\n    }\n\n    public magnitudeToY(magnitude: number): number {\n        // 40dB = 100\n        // -40dB = 0.01\n        const zcy = this._zeroChannelValueY;\n\n        return magnitude >= 100\n               ? this._maximumChannelValueY\n               : (magnitude < 0.01\n                  ? this._options.validYRangeHeight! + 1\n                  : Math.round((zcy - (zcy * Math.log(magnitude) / Math.LN10 * 0.5)) - 0.4));\n    }\n\n    public visibleBinToZoneIndex(visibleBinIndex: number): number {\n        if (visibleBinIndex >= (this._options.visibleBinCount! - 1)) {\n            return this._equivalentZones.length - 1;\n        }\n        else if (visibleBinIndex > 0) {\n            const z = this._equivalentZonesFrequencyCount;\n\n            for (let i = z.length - 1; i >= 0; i--) {\n                if (visibleBinIndex >= z[i]) {\n                    return i;\n                }\n            }\n        }\n\n        return 0;\n    }\n\n    public visibleBinToFrequency(visibleBinIndex: number): number {\n        const vf = this._visibleFrequencies;\n        const vbc = this._options.visibleBinCount!;\n\n        if (visibleBinIndex >= vbc - 1) {\n            return vf[vbc - 1];\n        }\n        else if (visibleBinIndex > 0) {\n            return vf[visibleBinIndex];\n        }\n\n        return vf[0];\n    }\n\n    public visibleBinToFrequencyGroup(visibleBinIndex: number): number[] {\n        const ez = this._equivalentZones;\n        const vf = this._visibleFrequencies;\n        const vbc = this._options.visibleBinCount!;\n\n        if (visibleBinIndex >= vbc - 1) {\n            return [Math.round(vf[vbc - 1]), Math.round(ez[ez.length - 1])];\n        }\n        else if (visibleBinIndex > 0) {\n            const ezc = this._equivalentZonesFrequencyCount;\n\n            for (let i = ezc.length - 1; i >= 0; i--) {\n                if (visibleBinIndex >= ezc[i]) {\n                    return [Math.round(vf[visibleBinIndex]), Math.round(ez[i])];\n                }\n            }\n        }\n\n        return [Math.round(vf[0]), Math.round(ez[0])];\n    }\n\n    public changeZoneY(channelIndex: number, x: number, y: number) {\n        let i = this.visibleBinToZoneIndex(x);\n        const ii = this._equivalentZonesFrequencyCount[i + 1];\n        const cy = this.clampY(y);\n        const curve = this._channelCurves[channelIndex];\n\n        for (i = this._equivalentZonesFrequencyCount[i]; i < ii; i++) {\n            curve[i] = cy;\n        }\n    }\n\n    private _updateBuffer() {\n        if (this._options.convolverCallback) {\n            const oldConvolver = this._convolver;\n            this._convolver = this.audioContext.createConvolver();\n            this._convolver.normalize = false;\n            this._convolver.buffer = this._filterKernel;\n            this._options.convolverCallback(oldConvolver, this._convolver);\n        } else {\n            this._convolver.buffer = this._filterKernel;\n        }\n    }\n\n    public copyFilter(sourceChannel: number, destinationChannel: number) {\n        const src = this._filterKernel.getChannelData(sourceChannel);\n        const dst = this._filterKernel.getChannelData(destinationChannel);\n\n        for (let i = (this._filterLength - 1); i >= 0; i--) {\n            dst[i] = src[i];\n        }\n\n        if (this._convolver) {\n            this._updateBuffer();\n        }\n    }\n\n    public updateFilter(updateBothChannels: boolean) {\n        const channelIndex = Math.max(this._channelIndex, 0);\n        const isSameFilterLR = channelIndex === -1;\n        const filterLength = this._filterLength;\n        const curve = this._channelCurves[channelIndex];\n        const valueCount = this._options.visibleBinCount!;\n        const bw = this._sampleRate / filterLength;\n        const filterLength2 = (filterLength >>> 1);\n        const filter = this._filterKernel.getChannelData(channelIndex);\n        const _visibleFrequencies = this._visibleFrequencies;\n        /* M = filterLength2, so, M_HALF_PI_FFTLEN2 = (filterLength2 * 0.5 * Math.PI) / filterLength2 */\n        const M_HALF_PI_FFTLEN2 = 0.5 * Math.PI;\n        let invMaxMag = 1;\n        let repeat = Number(this._isNormalized) + 1;\n\n        // fill in all filter points, either averaging or interpolating them as necessary\n        do {\n            repeat--;\n            let i = 1;\n            let ii = 0;\n\n            // tslint:disable-next-line:no-constant-condition\n            while (true) {\n                const freq = bw * i;\n\n                if (freq >= _visibleFrequencies[0]) {\n                    break;\n                }\n\n                const mag = this.yToMagnitude(curve[0]);\n                filter[i << 1] = mag * invMaxMag;\n                i++;\n            }\n\n            while (bw > _visibleFrequencies[ii + 1] - _visibleFrequencies[ii] &&\n                   i < filterLength2 && ii < valueCount - 1) {\n                const freq = bw * i;\n                let avg = 0;\n                let avgCount = 0;\n\n                do {\n                    avg += curve[ii];\n                    avgCount++;\n                    ii++;\n                } while (freq > _visibleFrequencies[ii] && ii < valueCount - 1);\n\n                const mag = this.yToMagnitude(avg / avgCount);\n                filter[i << 1] = mag * invMaxMag;\n                i++;\n            }\n\n            for (; i < filterLength2; i++) {\n                const freq = bw * i;\n                let mag: number;\n\n                if (freq >= _visibleFrequencies[valueCount - 1]) {\n                    mag = this.yToMagnitude(curve[valueCount - 1]);\n                }\n                else {\n                    while (ii < (valueCount - 1) && freq > _visibleFrequencies[ii + 1]) {\n                        ii++;\n                    }\n\n                    mag = this.yToMagnitude(\n                        Equalizer._lerp(_visibleFrequencies[ii], curve[ii],\n                                       _visibleFrequencies[ii + 1], curve[ii + 1], freq));\n                }\n                filter[i << 1] = mag * invMaxMag;\n            }\n            // since DC and Nyquist are purely real, do not bother with them in the for loop,\n            // just make sure neither one has a gain greater than 0 dB\n            filter[0] = (filter[2] >= 1 ? 1 : filter[2]);\n            filter[1] = (filter[filterLength - 2] >= 1 ? 1 : filter[filterLength - 2]);\n\n            // convert the coordinates from polar to rectangular\n            for (i = filterLength - 2; i >= 2; i -= 2) {\n                /*                -k.j\n                 * polar = Mag . e\n                 *\n                 * where:\n                 * k = (M / 2) * pi * i / (fft length / 2)\n                 * i = index varying from 0 to (fft length / 2)\n                 *\n                 * rectangular:\n                 * real = Mag . cos(-k)\n                 * imag = Mag . sin(-k)\n                 */\n                const k = M_HALF_PI_FFTLEN2 * (i >>> 1);\n                /* ****NOTE:\n                 * when using FFTReal ou FFTNR, k MUST BE passed as the argument of sin and cos, due to the\n                 * signal of the imaginary component\n                 * RFFT, intel and other fft's use the opposite signal... therefore, -k MUST BE passed!!\n                 */\n                filter[i + 1] = (filter[i] * Math.sin(k));\n                filter[i] *= Math.cos(k);\n            }\n\n            FFTReal(filter, filterLength, -1);\n\n            if (repeat) {\n                // get the actual filter response, and then, compensate\n                invMaxMag = this._applyWindowAndComputeActualMagnitudes(filter);\n\n                if (invMaxMag <= 0) {\n                    repeat = 0;\n                }\n\n                invMaxMag = 1.0 / invMaxMag;\n            }\n        } while (repeat);\n\n        if (isSameFilterLR) {\n            // copy the filter to the other channel\n            this.copyFilter(channelIndex, 1 - channelIndex);\n            return;\n        }\n\n        if (updateBothChannels) {\n            // update the other channel as well\n            const oldChannelIndex = this._channelIndex;\n\n            this._channelIndex = 1 - channelIndex;\n            this.updateFilter(false);\n            this._channelIndex = oldChannelIndex;\n            return;\n        }\n\n        if (this._convolver) {\n            this._updateBuffer();\n        }\n    }\n\n    public updateActualChannelCurve(channelIndex: number) {\n        const filterLength = this._filterLength;\n        const curve = this._actualChannelCurve;\n        const valueCount = this._options.visibleBinCount!;\n        const bw = this._sampleRate / filterLength;\n        const filterLength2 = (filterLength >>> 1);\n        const tmp = this._tmp;\n        const _visibleFrequencies = this._visibleFrequencies;\n        const filter = this._filterKernel.getChannelData(channelIndex);\n\n        this._applyWindowAndComputeActualMagnitudes(filter);\n\n        // tmp now contains (filterLength2 + 1) magnitudes\n        let i = 0;\n        let ii = 0;\n\n        while (ii < valueCount - 1 && i < filterLength2 && bw > _visibleFrequencies[ii + 1] - _visibleFrequencies[ii]) {\n            let freq = bw * i;\n\n            while (i < filterLength2 && freq + bw < _visibleFrequencies[ii]) {\n                i++;\n                freq = bw * i;\n            }\n\n            curve[ii] = this.magnitudeToY(\n                Equalizer._lerp(freq, tmp[i], freq + bw, tmp[i + 1], _visibleFrequencies[ii]));\n            ii++;\n        }\n\n        i++;\n\n        while (i < filterLength2 && ii < valueCount) {\n            let freq: number;\n            let avg = 0;\n            let avgCount = 0;\n\n            do {\n                avg += tmp[i];\n                avgCount++;\n                i++;\n                freq = bw * i;\n            } while (freq < _visibleFrequencies[ii] && i < filterLength2);\n\n            curve[ii] = this.magnitudeToY(avg / avgCount);\n            ii++;\n        }\n\n        i = (this._sampleRate >>> 1) >= _visibleFrequencies[valueCount - 1]\n            ? curve[ii - 1]\n            : this._options.validYRangeHeight! + 1;\n\n        for (; ii < valueCount; ii++) {\n            curve[ii] = i;\n        }\n    }\n\n    private _applyWindowAndComputeActualMagnitudes(filter: Float32Array): number {\n        const filterLength = this._filterLength;\n        const tmp = this._tmp;\n        const filterLength2 = (filterLength >>> 1);\n        const M = filterLength2;\n        const PI2_M = 2 * Math.PI / M;\n\n        // it is not possible to know what kind of window the browser will use,\n        // so make an assumption here... Blackman window!\n        // ...at least it is the one I used, back in C++ times :)\n        for (let i = M; i >= 0; i--) {\n            /* Hanning window */\n            // tmp[i] = filter[i] * (0.5 - (0.5 * cos(PI2_M * i)));\n            /* Hamming window */\n            // tmp[i] = filter[i] * (0.54 - (0.46 * cos(PI2_M * i)));\n            /* Blackman window */\n            tmp[i] = filter[i] * (0.42 - (0.5 * Math.cos(PI2_M * i)) + (0.08 * Math.cos(2 * PI2_M * i)));\n        }\n\n        for (let i = filterLength - 1; i > M; i--) {\n            tmp[i] = 0;\n        }\n\n        // calculate the spectrum\n        FFTReal(tmp, filterLength, 1);\n        // save Nyquist for later\n        const ii = tmp[1];\n        let maxMag = (tmp[0] > ii ? tmp[0] : ii);\n\n        for (let i = 2; i < filterLength; i += 2) {\n            const rval = tmp[i];\n            const ival = tmp[i + 1];\n            const mag = Math.sqrt((rval * rval) + (ival * ival));\n\n            tmp[i >>> 1] = mag;\n            if (mag > maxMag) {\n                maxMag = mag;\n            }\n        }\n\n        // restore Nyquist in its new position\n        tmp[filterLength2] = ii;\n        return maxMag;\n    }\n\n    private static _validateFilterLength(filterLength: number) {\n        if (filterLength < 8 || (filterLength & (filterLength - 1))) {\n            throw new Error('The FFT size must be power of 2 and not less than 8.');\n        }\n    }\n\n    private static _lerp(x0: number, y0: number, x1: number, y1: number, x: number): number {\n        return ((x - x0) * (y1 - y0) / (x1 - x0)) + y0;\n    }\n\n    // virtual properties\n\n    get filterLength(): number {\n        return this._filterLength;\n    }\n\n    set filterLength(newFilterLength: number) {\n        if (this._filterLength !== newFilterLength) {\n            Equalizer._validateFilterLength(newFilterLength);\n            this._filterLength = newFilterLength;\n            this._binCount = (newFilterLength >>> 1) + 1;\n            this._filterKernel = this._audioContext.createBuffer(2, newFilterLength, this._sampleRate);\n            this._tmp = new Float32Array(newFilterLength);\n            this.updateFilter(true);\n        }\n    }\n\n    get sampleRate(): number {\n        return this._sampleRate;\n    }\n\n    set sampleRate(newSampleRate: number) {\n        if (this.sampleRate !== newSampleRate) {\n            this._sampleRate = newSampleRate;\n            this._filterKernel = this._audioContext.createBuffer(2, this._filterLength, newSampleRate);\n            this.updateFilter(true);\n        }\n    }\n\n    get isNormalized(): boolean {\n        return this._isNormalized;\n    }\n\n    set isNormalized(isNormalized: boolean) {\n        if (this.isNormalized !== isNormalized) {\n            this._isNormalized = isNormalized;\n            this.updateFilter(true);\n        }\n    }\n\n    get audioContext(): AudioContext {\n        return this._audioContext;\n    }\n\n    set audioContext(newAudioContext: AudioContext) {\n        if (this.audioContext !== newAudioContext) {\n            const oldConvolver = this._convolver;\n            this._convolver.disconnect(0);\n            this._audioContext = newAudioContext;\n            this._filterKernel = newAudioContext.createBuffer(2, this._filterLength, this._sampleRate);\n            (this._convolver as any) = null;\n            this.updateFilter(true);\n            this._convolver = newAudioContext.createConvolver();\n            this._convolver.normalize = false;\n            this._convolver.buffer = this._filterKernel;\n            if (this._options.convolverCallback) {\n                this._options.convolverCallback(oldConvolver, this._convolver);\n            }\n        }\n    }\n\n    get options(): IEqualizerOptions {\n        return deepAssign({}, defaultOptions, this._options);\n    }\n\n    get visibleFrequencies(): Float32Array {\n        return this._visibleFrequencies;\n    }\n\n    get channelCurves(): Int16Array[] {\n        return this._channelCurves.slice();\n    }\n\n    get actualChannelCurve(): Int16Array {\n        return this._actualChannelCurve;\n    }\n\n    get convolver(): ConvolverNode {\n        return this._convolver;\n    }\n\n    get channelIndex(): number {\n        return this._channelIndex;\n    }\n\n    get zeroChannelValueY(): number {\n        return this._zeroChannelValueY;\n    }\n\n    get equivalentZonesFrequencyCount(): Float32Array {\n        return this._equivalentZonesFrequencyCount;\n    }\n\n    set channelIndex(newChannelIndex: number) {\n        this._channelIndex = newChannelIndex;\n    }\n}\n","/**\n * canvas-equalizer is distributed under the FreeBSD License\n *\n * Copyright (c) 2012-2017 Armando Meziat, Carlos Rafael Gimenes das Neves\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * The views and conclusions contained in the software and documentation are those\n * of the authors and should not be interpreted as representing official policies,\n * either expressed or implied, of the FreeBSD Project.\n *\n * https://github.com/radiojhero/canvas-equalizer\n */\n\nimport defaultLocale from '../locales/en.json';\n\nimport ILocale from './ILocale';\n\ninterface ILocaleSet {\n    [langId: string]: ILocale;\n}\n\nconst defaultLanguage = 'en';\n\nexport default class L10n {\n\n    private _language: string;\n    private _locales: ILocaleSet = {};\n\n    constructor(language: string = defaultLanguage) {\n        this._language = language;\n        this.loadLocale(defaultLanguage, defaultLocale);\n    }\n\n    public loadLocale(language: string, locale: ILocale) {\n        this._locales[language] = locale;\n    }\n\n    public get(tag: string) {\n        let locales = this._locales[this._language] || this._locales[defaultLanguage];\n\n        if (locales[tag] === undefined) {\n            locales = this._locales[defaultLanguage];\n        }\n\n        return locales[tag];\n    }\n\n    public format(str: string, ...args: any[]): string {\n        str = this.get(str);\n        args.forEach((arg: any, i: number) => {\n            str = str.replace(new RegExp(`\\\\{${i}\\\\}`, 'g'), arg.toLocaleString(this._language));\n        });\n\n        return str;\n    }\n\n    get language(): string {\n        return this._language;\n    }\n\n    set language(language: string) {\n        this._language = language;\n    }\n}\n","/**\n * canvas-equalizer is distributed under the FreeBSD License\n *\n * Copyright (c) 2012-2017 Armando Meziat, Carlos Rafael Gimenes das Neves\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * The views and conclusions contained in the software and documentation are those\n * of the authors and should not be interpreted as representing official policies,\n * either expressed or implied, of the FreeBSD Project.\n *\n * https://github.com/radiojhero/canvas-equalizer\n */\n\nimport deepAssign from 'deep-assign';\n\nimport {\n    keyPressed,\n    elemCoords,\n    attachPointer, detachPointer, cancelEvent,\n    throttledFunction, addThrottledEvent, removeThrottledEvent,\n} from './Common';\n\nimport Equalizer from './Equalizer';\nimport L10n from './L10n';\n\nimport ICanvasEqualizerOptions from './ICanvasEqualizerOptions';\nimport ILocale from './ILocale';\n\nconst defaultOptions: ICanvasEqualizerOptions = {\n    classNamespace: 'GE',\n    filterOptions: {},\n    updateFilterOnDrag: true,\n};\n\nexport default class CanvasEqualizer {\n\n    private _options: ICanvasEqualizerOptions;\n    private _filter: Equalizer;\n    private _element: HTMLElement;\n    private _canvas: HTMLCanvasElement;\n    private _ctx: CanvasRenderingContext2D;\n    private _rangeImage: CanvasGradient;\n    private _btnMnu: HTMLButtonElement;\n    private _mnu: HTMLElement;\n    private _mnuChBL: HTMLButtonElement;\n    private _mnuChL: HTMLButtonElement;\n    private _mnuChBR: HTMLButtonElement;\n    private _mnuChR: HTMLButtonElement;\n    private _mnuShowZones: HTMLButtonElement;\n    private _mnuEditZones: HTMLButtonElement;\n    private _mnuNormalizeCurves: HTMLButtonElement;\n    private _mnuShowActual: HTMLButtonElement;\n    private _lblCursor: HTMLElement;\n    private _lblCurve: HTMLElement;\n    private _lblFrequency: HTMLElement;\n    private _stb: HTMLElement;\n    private _showZones = false;\n    private _editZones = false;\n    private _isActualChannelCurveNeeded = true;\n    private _currentChannelIndex = 0;\n    private _isSameFilterLR = true;\n    private _drawingMode = 0;\n    private _lastDrawX = 0;\n    private _lastDrawY = 0;\n    private _barHideTimeout: number;\n    private _l10n: L10n;\n    private _isRTL = false;\n\n    constructor(filterLength: number, audioContext: AudioContext, options: ICanvasEqualizerOptions = {}) {\n        this._options = deepAssign({}, defaultOptions, options);\n        this._filter = new Equalizer(filterLength, audioContext, this._options.filterOptions);\n        this._l10n = new L10n(this._options.language);\n    }\n\n    public createControl(placeholder: HTMLElement): HTMLCanvasElement {\n        if (!this._ctx) {\n            const createLabel = (name: string, content: string) => {\n                const lbl = document.createElement('div');\n                lbl.className = `${clsNS}LBL ${clsNS}LBL${name}`;\n                lbl.innerHTML = this._l10n.get(content);\n                return lbl;\n            };\n            const createMenuSep = () => {\n                const s = document.createElement('div');\n                s.className = `${clsNS}MNUSEP`;\n                s.setAttribute('role', 'separator');\n                return s;\n            };\n            const createMenuLabel = (text: string) => {\n                const l = document.createElement('div');\n                l.className = `${clsNS}MNULBL`;\n                l.textContent = this._l10n.get(text);\n                return l;\n            };\n            const createMenuItem = (text: string, checkable: boolean | string, checked: boolean,\n                                    clickHandler: (e: MouseEvent) => any) => {\n                const i = document.createElement('button');\n                i.type = 'button';\n                i.className = `${clsNS}MNUIT ${clsNS}CLK`;\n\n                if (checkable) {\n                    if (typeof checkable === 'string') {\n                        i.dataset['radioGroup'] = checkable;\n                        i.setAttribute('role', 'menuitemradio');\n                    }\n                    else {\n                        i.setAttribute('role', 'menuitemcheckbox');\n                    }\n\n                    const s = document.createElement('span');\n                    s.textContent = typeof checkable === 'string' ? '● ' : '■ ';\n                    i.appendChild(s);\n                    this._checkMenu(i, checked);\n                }\n                else {\n                    i.setAttribute('role', 'menuitem');\n                }\n\n                i.appendChild(document.createTextNode(this._l10n.get(text)));\n\n                if (clickHandler) {\n                    i.addEventListener('click', clickHandler);\n                }\n\n                i.addEventListener('mouseenter', () => {\n                    i.focus();\n                });\n                i.addEventListener('mouseleave', () => {\n                    i.blur();\n                });\n\n                return i;\n            };\n            const clsNS = this._options.classNamespace!;\n\n            this._element = placeholder;\n            placeholder.className = clsNS;\n\n            if (/\\bip(?:[ao]d|hone)\\b/i.test(navigator.userAgent) && !(window as any).MSStream) {\n                placeholder.classList.add(`${clsNS}IOS`);\n            }\n\n            if (getComputedStyle(placeholder).direction === 'rtl') {\n                placeholder.classList.add('RTL');\n                this._isRTL = true;\n            }\n\n            placeholder.addEventListener('contextmenu', cancelEvent);\n\n            this._stb = document.createElement('div');\n            this._stb.className = `${clsNS}STB`;\n            placeholder.appendChild(this._stb);\n\n            this._canvas = document.createElement('canvas');\n            this._canvas.className = `${clsNS}CNV`;\n            attachPointer(this._canvas, 'down', this._canvasMouseDown);\n            attachPointer(this._canvas, 'move', this._canvasMouseMove);\n            attachPointer(this._canvas, 'up', this._canvasMouseUp);\n            this._canvas.addEventListener('contextmenu', cancelEvent);\n            placeholder.appendChild(this._canvas);\n            addThrottledEvent(window, 'resize', this._windowResize);\n\n            const ctx = this._canvas.getContext('2d');\n\n            if (!ctx) {\n                throw new Error('Unable to get a 2D context.');\n            }\n\n            this._ctx = ctx;\n\n            this._stb.appendChild(this._lblCursor = createLabel('CSR', 'cursor.label'));\n            this._stb.appendChild(this._lblCurve = createLabel('CRV', 'curve.label'));\n            this._stb.appendChild(this._lblFrequency = createLabel('FRQ', 'frequency.label'));\n            this._setStatusBar(0, this._filter.zeroChannelValueY, this._filter.zeroChannelValueY);\n\n            this._btnMnu = document.createElement('button');\n            this._btnMnu.type = 'button';\n            this._btnMnu.className = `${clsNS}BTN ${clsNS}CLK`;\n            this._btnMnu.setAttribute('aria-haspopup', 'true');\n            this._btnMnu.setAttribute('aria-label', this._l10n.get('menu'));\n            this._btnMnu.addEventListener('click', this._btnMnuClick);\n            this._btnMnu.addEventListener('keydown', this._btnMnuKeyDown);\n            this._btnMnu.addEventListener('mouseenter', () => {\n                this._btnMnu.focus();\n            });\n            this._btnMnu.addEventListener('mouseleave', () => {\n                this._btnMnu.blur();\n            });\n            this._stb.appendChild(this._btnMnu);\n\n            this._mnu = document.createElement('div');\n            this._mnu.className = `${clsNS}MNU`;\n            this._mnu.setAttribute('role', 'menu');\n            this._mnu.addEventListener('keydown', this._mnuKeyDown);\n            this._mnu.appendChild(createMenuLabel('menu.both'));\n            this._mnu.appendChild(this._mnuChBL =\n                createMenuItem('menu.both.left', 'curve', true, this._mnuChBLClick));\n            this._mnu.appendChild(this._mnuChBR =\n                createMenuItem('menu.both.right', 'curve', false, this._mnuChBRClick));\n            this._mnu.appendChild(createMenuSep());\n            this._mnu.appendChild(createMenuLabel('menu.one'));\n            this._mnu.appendChild(this._mnuChL =\n                createMenuItem('menu.one.left', 'curve', false, this._mnuChLClick));\n            this._mnu.appendChild(this._mnuChR =\n                createMenuItem('menu.one.right', 'curve', false, this._mnuChRClick));\n            this._mnu.appendChild(createMenuSep());\n            this._mnu.appendChild(this._mnuShowZones =\n                createMenuItem('menu.zones', true, false, this._mnuShowZonesClick));\n            this._mnu.appendChild(this._mnuEditZones =\n                createMenuItem('menu.zoneEdit', true, false, this._mnuEditZonesClick));\n            this._mnu.appendChild(createMenuSep());\n            this._mnu.appendChild(this._mnuNormalizeCurves =\n                createMenuItem('menu.normalizeCurves', true, false, this._mnuNormalizeCurvesClick));\n            this._mnu.appendChild(this._mnuShowActual =\n                createMenuItem('menu.actualResponse', true, true, this._mnuShowActualClick));\n            this._stb.appendChild(this._mnu);\n            this._toggleMenu(false);\n\n            this._fixCanvasSize();\n            this._drawCurve();\n        }\n        return this._canvas;\n    }\n\n    public destroyControl() {\n        if (this._ctx) {\n            removeThrottledEvent(window, 'resize', this._windowResize);\n            delete this._canvas;\n            delete this._lblCursor;\n            delete this._lblCurve;\n            delete this._lblFrequency;\n            delete this._btnMnu;\n            delete this._mnu;\n            delete this._mnuChBL;\n            delete this._mnuChL;\n            delete this._mnuChBR;\n            delete this._mnuChR;\n            delete this._mnuShowZones;\n            delete this._mnuEditZones;\n            delete this._mnuNormalizeCurves;\n            delete this._mnuShowActual;\n            delete this._stb;\n            delete this._ctx;\n            delete this._rangeImage;\n            this._element.innerHTML = '';\n            delete this._element;\n            clearTimeout(this._barHideTimeout);\n        }\n    }\n\n    public reset() {\n        this._filter.reset();\n        this._drawCurve();\n    }\n\n    public loadLocale(language: string, locale: ILocale) {\n        this._l10n.loadLocale(language, locale);\n    }\n\n    /* tslint:disable:no-magic-numbers */\n    private _formatDB(dB: number): string {\n        if (dB < -40) {\n            dB = -Infinity;\n        }\n\n        const ret = dB.toLocaleString(this._l10n.language, { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n        return dB < 0 ? ret.replace('-', '−') : (dB === 0 ? '−' + ret : '+' + ret);\n    }\n\n    private _formatFrequencyUnit = (frequency: number, compact: boolean): string => {\n        let unit = 'Hz';\n\n        if (compact) {\n            if (frequency >= 1000) {\n                unit = 'k' + unit;\n                frequency = frequency / 1000;\n            }\n        }\n\n        return this._l10n.format('frequency.format', frequency, this._l10n.get(`frequency.unit.${unit}`));\n    }\n\n    private _formatFrequency(frequencyAndEquivalent: number[]): string {\n        return this._l10n.format('frequency.text',\n            ...frequencyAndEquivalent.map((frequency: number, i: number) => this._formatFrequencyUnit(frequency, !!i)));\n    }\n    /* tslint:enable:no-magic-numbers */\n\n    private _checkMenu(mnu: HTMLButtonElement, chk: boolean) {\n\n        function inner(elem: HTMLElement, toggle: boolean) {\n            if (elem) {\n                elem.style.visibility = toggle ? 'visible' : 'hidden';\n                elem.setAttribute('aria-checked', toggle.toString());\n            }\n        }\n\n        if (chk && mnu.dataset['radioGroup']) {\n            [].slice.call(this._mnu.querySelectorAll(`[data-radio-group=\"${mnu.dataset['radioGroup']}\"]`))\n                .forEach((elem: HTMLButtonElement) => {\n                    inner(elem.firstChild as HTMLElement, false);\n                });\n        }\n\n        inner(mnu.firstChild as HTMLElement, chk);\n    }\n\n    private _drawCurve() {\n        /* tslint:disable:no-magic-numbers */\n        // all the 0.5's here are because of this explanation:\n        // http://stackoverflow.com/questions/195262/can-i-turn-off-antialiasing-on-an-html-canvas-element\n        // \"Draw your 1-pixel lines on coordinates like ctx.lineTo(10.5, 10.5). Drawing a one-pixel line\n        // over the point (10, 10) means, that this 1 pixel at that position reaches from 9.5 to 10.5 which\n        // results in two lines that get drawn on the canvas.\n        function pixelRound(x: number): number {\n            return Math.round(x) + middleOffset;\n        }\n\n        const ctx = this._ctx;\n        const canvas = this._canvas;\n        const pixelRatio = window.devicePixelRatio;\n        const width = canvas.width / pixelRatio;\n        const height = canvas.height / pixelRatio;\n        const widthRatio = this._widthRatio();\n        const heightRatio = this._heightRatio();\n        const widthMinus1 = this._filter.options.visibleBinCount! - 1;\n        const middleOffset = 0.5;\n        let curve = this._filter.channelCurves[this._currentChannelIndex];\n\n        if (!ctx) {\n            return false;\n        }\n\n        ctx.fillStyle = '#303030';\n        ctx.fillRect(0, 0, width, height);\n        ctx.lineWidth = 1;\n        ctx.strokeStyle = '#5a5a5a';\n        ctx.beginPath();\n        let x = width + 1 + middleOffset;\n        let y = pixelRound(this._filter.zeroChannelValueY * heightRatio);\n        ctx.moveTo(x, y);\n\n        while (x > 0) {\n            ctx.lineTo(x - 4, y);\n            x -= 10;\n            ctx.moveTo(x, y);\n        }\n\n        ctx.stroke();\n        ctx.font = 'bold 10pt Verdana';\n        ctx.textAlign = this._isRTL ? 'left' : 'right';\n        ctx.fillStyle = '#5a5a5a';\n        ctx.fillText('\\u200e−0dB', this._isRTL ? 1 : width - 1,\n            Math.round(this._filter.zeroChannelValueY * heightRatio) - 2);\n        ctx.beginPath();\n        x = width - 1 - middleOffset;\n        y = pixelRound(this._filter.options.validYRangeHeight! * heightRatio);\n        ctx.moveTo(x, y);\n\n        while (x > 0) {\n            ctx.lineTo(x - 4, y);\n            x -= 10;\n            ctx.moveTo(x, y);\n        }\n\n        ctx.stroke();\n        ctx.fillText('\\u200e−∞dB', this._isRTL ? 1 : width - 1,\n            Math.round(this._filter.options.validYRangeHeight! * heightRatio) - 2);\n\n        if (this._showZones) {\n            for (let i = this._filter.equivalentZonesFrequencyCount.length - 2; i > 0; i--) {\n                x = pixelRound(this._filter.equivalentZonesFrequencyCount[i] * widthRatio);\n                y = 0;\n                ctx.beginPath();\n                ctx.moveTo(x, y);\n\n                while (y < height) {\n                    ctx.lineTo(x, y + 4);\n                    y += 10;\n                    ctx.moveTo(x, y);\n                }\n\n                ctx.stroke();\n            }\n        }\n\n        ctx.strokeStyle = this._isActualChannelCurveNeeded && !this._drawingMode ? '#707070' : this._rangeImage;\n        ctx.beginPath();\n        ctx.moveTo(0.5, pixelRound(curve[0] * heightRatio));\n\n        for (x = 1; x < widthMinus1; x++) {\n            ctx.lineTo(pixelRound(x * widthRatio), pixelRound(curve[x] * heightRatio));\n        }\n\n        // just to fill up the last pixel!\n        ctx.lineTo(Math.round(x * widthRatio) + 1, pixelRound(curve[x] * heightRatio));\n        ctx.stroke();\n\n        if (this._isActualChannelCurveNeeded && !this._drawingMode) {\n            curve = this._filter.actualChannelCurve;\n            ctx.strokeStyle = this._rangeImage;\n            ctx.beginPath();\n            ctx.moveTo(middleOffset, pixelRound(curve[0] * heightRatio));\n\n            for (x = 1; x < widthMinus1; x++) {\n                ctx.lineTo(pixelRound(x * widthRatio),\n                    pixelRound(curve[x] * heightRatio));\n            }\n\n            // just to fill up the last pixel!\n            ctx.lineTo(Math.round(x * widthRatio) + 1, pixelRound(curve[x] * heightRatio));\n            ctx.stroke();\n        }\n\n        return true;\n        /* tslint:enable:no-magic-numbers */\n    }\n\n    private _widthRatio(): number {\n        return this._canvas.width / window.devicePixelRatio / this._filter.options.visibleBinCount!;\n    }\n\n    private _heightRatio(): number {\n        const height = this._stb.clientHeight;\n        // tslint:disable-next-line:no-magic-numbers\n        return (this._canvas.height / window.devicePixelRatio - height - 5) / this._filter.options.validYRangeHeight!;\n    }\n\n    private _fixCanvasSize() {\n        this._canvas.style.display = 'none';\n        const rect = this._element.getBoundingClientRect();\n        const pixelRatio = window.devicePixelRatio;\n        this._canvas.style.display = '';\n        this._canvas.style.width = rect.width + 'px';\n        this._canvas.style.height = rect.height + 'px';\n        this._canvas.width = rect.width * pixelRatio;\n        this._canvas.height = rect.height * pixelRatio;\n\n        this._ctx.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n\n        /* tslint:disable:no-magic-numbers */\n        this._rangeImage = this._ctx.createLinearGradient(0, 0, 0, rect.height - this._stb.clientHeight - 5);\n        this._rangeImage.addColorStop(0, '#ff0000');\n        this._rangeImage.addColorStop(0.1875, '#ffff00');\n        this._rangeImage.addColorStop(0.39453125, '#00ff00');\n        this._rangeImage.addColorStop(0.60546875, '#00ffff');\n        this._rangeImage.addColorStop(0.796875, '#0000ff');\n        this._rangeImage.addColorStop(1, '#ff00ff');\n        /* tslint:enable:no-magic-numbers */\n\n        this._drawCurve();\n    }\n\n    private _wrappedUpdateFilter = () => {\n        this._filter.updateFilter(false);\n    }\n\n    private _setLabelParam(label: HTMLElement, text: string) {\n        const span = label.querySelector('span');\n\n        if (span) {\n            span.textContent = text;\n        }\n    }\n\n    private _setStatusBar(x: number, y: number, curveY: number) {\n        this._setLabelParam(this._lblCursor, this._formatDB(this._filter.yToDB(y)));\n        this._setLabelParam(this._lblCurve, this._formatDB(this._filter.yToDB(curveY)));\n        this._setLabelParam(this._lblFrequency, this._formatFrequency(this._filter.visibleBinToFrequencyGroup(x)));\n    }\n\n    private _toggleMenu(toggle?: boolean) {\n        toggle = toggle === undefined ? this._mnu.style.display === 'none' : toggle;\n\n        this._mnu.style.display = toggle ? '' : 'none';\n        this._btnMnu.textContent = toggle ? '▼' : '▲';\n    }\n\n    // events\n\n    private _btnMnuClick = (e: MouseEvent) => {\n        if (!e.button) {\n            this._toggleMenu();\n        }\n    }\n\n    private _mnuChBLClick = (e: MouseEvent) => {\n        this._mnuChBClick(e, 0);\n    }\n\n    private _mnuChBRClick = (e: MouseEvent) => {\n        this._mnuChBClick(e, 1);\n    }\n\n    private _mnuChBClick = (e: MouseEvent, channelIndex: number) => {\n        if (!e.button) {\n            if (!this._isSameFilterLR || this._currentChannelIndex !== channelIndex) {\n                if (this._isSameFilterLR) {\n                    this._currentChannelIndex = channelIndex;\n                    this._filter.channelIndex = -1;\n                    this._filter.updateFilter(true);\n\n                    if (this._isActualChannelCurveNeeded) {\n                        this._filter.updateActualChannelCurve(channelIndex);\n                    }\n\n                    this._drawCurve();\n                }\n                else {\n                    this._isSameFilterLR = true;\n                    this._filter.copyFilter(channelIndex, 1 - channelIndex);\n                    if (this._currentChannelIndex !== channelIndex) {\n                        this._currentChannelIndex = channelIndex;\n\n                        if (this._isActualChannelCurveNeeded) {\n                            this._filter.updateActualChannelCurve(channelIndex);\n                        }\n\n                        this._drawCurve();\n                    }\n                }\n\n                this._checkMenu(this._mnuChBL, channelIndex === 0);\n                this._checkMenu(this._mnuChBR, channelIndex === 1);\n            }\n        }\n    }\n\n    private _mnuChLClick = (e: MouseEvent) => {\n        this._mnuChLRClick(e, 0);\n    }\n\n    private _mnuChRClick = (e: MouseEvent) => {\n        this._mnuChLRClick(e, 1);\n    }\n\n    private _mnuChLRClick = (e: MouseEvent, channelIndex: number) => {\n        if (!e.button) {\n            if (this._isSameFilterLR || this._currentChannelIndex !== channelIndex) {\n                if (this._isSameFilterLR) {\n                    this._isSameFilterLR = false;\n                    this._filter.channelIndex = 1 - this._currentChannelIndex;\n                    this._filter.updateFilter(false);\n                }\n\n                if (this._currentChannelIndex !== channelIndex) {\n                    this._currentChannelIndex = channelIndex;\n\n                    if (this._isActualChannelCurveNeeded) {\n                        this._filter.updateActualChannelCurve(channelIndex);\n                    }\n\n                    this._drawCurve();\n                }\n\n                this._checkMenu(this._mnuChL, channelIndex === 0);\n                this._checkMenu(this._mnuChR, channelIndex === 1);\n            }\n        }\n    }\n\n    private _mnuShowZonesClick = (e: MouseEvent) => {\n        if (!e.button) {\n            this._showZones = !this._showZones;\n            this._checkMenu(this._mnuShowZones, this._showZones);\n            this._drawCurve();\n        }\n    }\n\n    private _mnuEditZonesClick = (e: MouseEvent) => {\n        if (!e.button) {\n            this._editZones = !this._editZones;\n            this._canvas.classList[this._editZones ? 'add' : 'remove'](`${this._options.classNamespace}CNVZON`);\n            this._checkMenu(this._mnuEditZones, this._editZones);\n        }\n    }\n\n    private _mnuNormalizeCurvesClick = (e: MouseEvent) => {\n        if (!e.button) {\n            this._filter.isNormalized = !this._filter.isNormalized;\n            this._checkMenu(this._mnuNormalizeCurves, this._filter.isNormalized);\n\n            if (this._isActualChannelCurveNeeded) {\n                this._filter.updateActualChannelCurve(this._currentChannelIndex);\n                this._drawCurve();\n            }\n        }\n    }\n\n    private _mnuShowActualClick = (e: MouseEvent) => {\n        if (!e.button) {\n            this._isActualChannelCurveNeeded = !this._isActualChannelCurveNeeded;\n            this._checkMenu(this._mnuShowActual, this._isActualChannelCurveNeeded);\n\n            if (this._isActualChannelCurveNeeded) {\n                this._filter.updateActualChannelCurve(this._currentChannelIndex);\n            }\n\n            this._drawCurve();\n        }\n    }\n\n    private _btnMnuKeyDown = (e: KeyboardEvent) => {\n        if (keyPressed(e, 'ArrowUp', 'ArrowDown')) {\n            cancelEvent(e);\n            this._toggleMenu(keyPressed(e, 'ArrowUp'));\n\n            window.setTimeout(() => {\n                const items = this._mnu.querySelectorAll(`.${this._options.classNamespace!}MNUIT`);\n                (items[items.length - 1] as HTMLButtonElement).focus();\n            });\n        }\n    }\n\n    private _mnuKeyDown = (e: KeyboardEvent) => {\n\n        const moveFocus = (elem: Node, down: boolean) => {\n            const siblingProp = down ? 'nextSibling' : 'previousSibling';\n            let currentElem: Node | null = elem;\n\n            do {\n                currentElem = currentElem[siblingProp];\n\n                if (currentElem instanceof HTMLButtonElement &&\n                    currentElem.classList.contains(`${this._options.classNamespace!}MNUIT`)) {\n                    currentElem.focus();\n                    return true;\n                }\n            } while (currentElem);\n\n            return false;\n        };\n\n        if (keyPressed(e, 'ArrowUp', 'ArrowDown')) {\n            cancelEvent(e);\n            const down = keyPressed(e, 'ArrowDown');\n            if (!moveFocus(e.target as Node, down) && down) {\n                this._btnMnu.focus();\n            }\n        }\n    }\n\n    private _canvasMouseDown = (e: MouseEvent) => {\n        if (!e.button) {\n            if (!this._drawingMode) {\n                const { x, y } = elemCoords(this._canvas, e);\n\n                const normX = Math.floor(x / this._widthRatio());\n                const normY = y / this._heightRatio();\n\n                if (normX >= 0 && normX < this._filter.options.visibleBinCount!) {\n                    this._drawingMode = 1;\n                    if (this._editZones) {\n                        this._filter.changeZoneY(this._currentChannelIndex, normX, normY);\n                    }\n                    else {\n                        this._filter.channelCurves[this._currentChannelIndex][normX] = this._filter.clampY(normY);\n                        this._lastDrawX = normX;\n                        this._lastDrawY = normY;\n                    }\n\n                    this._drawCurve();\n\n                    if (this._canvas.setPointerCapture) {\n                        this._canvas.setPointerCapture((e as PointerEvent).pointerId);\n                    }\n                    else if (!(e as any).clonedFromTouch) {\n                        detachPointer(this._canvas, 'move', this._canvasMouseMove);\n                        detachPointer(this._canvas, 'up', this._canvasMouseUp);\n                        attachPointer(document, 'move', this._documentMouseMove, true);\n                        attachPointer(document, 'up', this._documentMouseUp, true);\n                    }\n                }\n            }\n\n            return cancelEvent(e);\n        }\n\n        return true;\n    }\n\n    private _canvasMouseUp = (e: MouseEvent) => {\n        if (this._drawingMode) {\n            this._drawingMode = 0;\n            this._filter.channelIndex = this._currentChannelIndex;\n            this._filter.updateFilter(false);\n\n            if (this._isActualChannelCurveNeeded) {\n                this._filter.updateActualChannelCurve(this._currentChannelIndex);\n            }\n\n            this._drawCurve();\n\n            if (this._canvas.releasePointerCapture) {\n                this._canvas.releasePointerCapture((e as PointerEvent).pointerId);\n            }\n            else if (!(e as any).clonedFromTouch) {\n                detachPointer(document, 'move', this._documentMouseMove, true);\n                detachPointer(document, 'up', this._documentMouseUp, true);\n                attachPointer(this._canvas, 'move', this._canvasMouseMove);\n                attachPointer(this._canvas, 'up', this._canvasMouseUp);\n            }\n        }\n    }\n\n    private _canvasMouseMove = (e: MouseEvent) => {\n        let curve = this._filter.channelCurves[this._currentChannelIndex];\n        const { x, y } = elemCoords(this._canvas, e);\n\n        if (this._drawingMode || (x >= 0 && x < this._canvas.width && y >= 0 && y < this._canvas.height)) {\n            let normX = Math.floor(x / this._widthRatio());\n            let normY = y / this._heightRatio();\n\n            if (normX < 0) {\n                normX = 0;\n            }\n            else if (normX >= this._filter.options.visibleBinCount!) {\n                normX = this._filter.options.visibleBinCount! - 1;\n            }\n\n            if (this._drawingMode) {\n                if (this._editZones) {\n                    this._filter.changeZoneY(this._currentChannelIndex, normX, normY);\n                }\n                else {\n                    if (Math.abs(normX - this._lastDrawX) > 1) {\n                        const delta = (normY - this._lastDrawY) / Math.abs(normX - this._lastDrawX);\n                        const inc = ((normX < this._lastDrawX) ? -1 : 1);\n                        normY = this._lastDrawY + delta;\n                        let count = Math.abs(normX - this._lastDrawX) - 1;\n\n                        for (normX = this._lastDrawX + inc; count > 0; normX += inc, count--) {\n                            curve[normX] = this._filter.clampY(normY);\n                            normY += delta;\n                        }\n                    }\n\n                    curve[normX] = this._filter.clampY(normY);\n                    this._lastDrawX = normX;\n                    this._lastDrawY = normY;\n                }\n                this._drawCurve();\n\n                if (this._options.updateFilterOnDrag) {\n                    // tslint:disable-next-line:no-magic-numbers\n                    throttledFunction(this._wrappedUpdateFilter, 150);\n                }\n            }\n            else if (this._isActualChannelCurveNeeded) {\n                curve = this._filter.actualChannelCurve;\n            }\n\n            this._setStatusBar(normX, normY, curve[normX]);\n\n            if (this._drawingMode) {\n                return cancelEvent(e);\n            }\n        }\n\n        return true;\n    }\n\n    private _windowResize = () => {\n        this._fixCanvasSize();\n    }\n\n    private _documentMouseMove = (e: MouseEvent) =>\n        this._canvasMouseMove(e);\n\n    private _documentMouseUp = (e: MouseEvent) => {\n        this._canvasMouseUp(e);\n    }\n\n    // virtual properties\n\n    get options(): ICanvasEqualizerOptions {\n        return deepAssign({}, defaultOptions, this._options);\n    }\n\n    get filterLength(): number {\n        return this._filter.filterLength;\n    }\n\n    set filterLength(newFilterLength: number) {\n        if (this._filter.filterLength !== newFilterLength) {\n            this._filter.filterLength = newFilterLength;\n\n            if (this._isActualChannelCurveNeeded) {\n                this._filter.updateActualChannelCurve(this._currentChannelIndex);\n            }\n\n            this._drawCurve();\n        }\n    }\n\n    get sampleRate(): number {\n        return this._filter.sampleRate;\n    }\n\n    set sampleRate(newSampleRate: number) {\n        if (this._filter.sampleRate !== newSampleRate) {\n            this._filter.sampleRate = newSampleRate;\n\n            if (this._isActualChannelCurveNeeded) {\n                this._filter.updateActualChannelCurve(this._currentChannelIndex);\n            }\n\n            this._drawCurve();\n        }\n    }\n\n    get audioContext(): AudioContext {\n        return this._filter.audioContext;\n    }\n\n    set audioContext(newAudioContext: AudioContext) {\n        if (this._filter.audioContext !== newAudioContext) {\n            this._filter.audioContext = newAudioContext;\n        }\n    }\n\n    get language(): string {\n        return this._l10n.language;\n    }\n\n    set language(language: string) {\n        this._l10n.language = language;\n    }\n\n    get visibleFrequencies(): Float32Array {\n        return this._filter.visibleFrequencies;\n    }\n\n    get convolver(): ConvolverNode {\n        return this._filter.convolver;\n    }\n}\n","/**\n * canvas-equalizer is distributed under the FreeBSD License\n *\n * Copyright (c) 2012-2017 Armando Meziat, Carlos Rafael Gimenes das Neves\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * The views and conclusions contained in the software and documentation are those\n * of the authors and should not be interpreted as representing official policies,\n * either expressed or implied, of the FreeBSD Project.\n *\n * https://github.com/radiojhero/canvas-equalizer\n */\n\nimport CanvasEqualizer from './CanvasEqualizer';\nexport default CanvasEqualizer;\n"],"names":["window","CustomEvent","e","MouseEvent","eventType","params","bubbles","cancelable","mouseEvent","document","createEvent","initMouseEvent","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","prototype","Event","attachPointer","detachPointer","wrap","func","wrapper","tag","elem","wrapperTag","unwrap","push","ret","filter","entry","i","PointerEvent","observable","eventName","targetFunction","capturePhase","addEventListener","removeEventListener","mappings","down","move","up","touch","changedTouches","pseudoMouse","clonedFromTouch","result","defaultPrevented","cancelEvent","forEach","mapping","runningFuncs","keyFix","Backspace","Escape","End","Home","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Delete","keyPressed","chars","length","chr","Object","keys","indexOf","key","keyCode","Array","isArray","preventDefault","stopPropagation","throttledFunction","timeout","splice","setTimeout","requestAnimationFrame","addThrottledEvent","running","removeThrottledEvent","elemCoords","rect","getBoundingClientRect","x","left","y","top","FFTComplex","data","n","isign","nn","mmax","m","j","istep","wr","wpr","wpi","wi","theta","tempr","tempi","halfmmax","dj1","dj","Math","PI","sin","FFTReal","i1","i2","i3","i4","d1","d2","d3","d4","n4","c2","h1r","h1i","h2r","h2i","defaultOptions","validYRangeHeight","visibleBinCount","Equalizer","constructor","filterLength","audioContext","options","_validateFilterLength","_options","deepAssign","_filterLength","_sampleRate","sampleRate","_isNormalized","_binCount","_audioContext","_filterKernel","createBuffer","_tmp","Float32Array","_channelCurves","Int16Array","_actualChannelCurve","_channelIndex","_zeroChannelValueY","_maximumChannelValue","_minimumChannelValue","_minusInfiniteChannelValue","_maximumChannelValueY","_minimumChannelValueY","_visibleFrequencies","_equivalentZones","Uint16Array","eqz","ratio","freqSteps","firstFreqs","f","map","num","round","_equivalentZonesFrequencyCount","s","reset","_convolver","createConvolver","normalize","buffer","updateFilter","updateActualChannelCurve","clampY","maxY","minY","yToDB","Infinity","_lerp","yToMagnitude","exp","LN10","magnitudeToY","magnitude","zcy","log","visibleBinToZoneIndex","visibleBinIndex","z","visibleBinToFrequency","vf","vbc","visibleBinToFrequencyGroup","ez","ezc","changeZoneY","channelIndex","ii","cy","curve","_updateBuffer","convolverCallback","oldConvolver","copyFilter","sourceChannel","destinationChannel","src","getChannelData","dst","updateBothChannels","max","isSameFilterLR","valueCount","bw","filterLength2","M_HALF_PI_FFTLEN2","invMaxMag","repeat","Number","freq","mag","avg","avgCount","k","cos","_applyWindowAndComputeActualMagnitudes","oldChannelIndex","tmp","M","PI2_M","maxMag","rval","ival","sqrt","Error","x0","y0","x1","y1","newFilterLength","newSampleRate","isNormalized","newAudioContext","disconnect","visibleFrequencies","channelCurves","slice","actualChannelCurve","convolver","zeroChannelValueY","equivalentZonesFrequencyCount","newChannelIndex","defaultLanguage","L10n","language","_language","loadLocale","defaultLocale","locale","_locales","get","locales","undefined","format","str","args","arg","replace","RegExp","toLocaleString","classNamespace","filterOptions","updateFilterOnDrag","CanvasEqualizer","frequency","compact","unit","_l10n","_filter","button","_toggleMenu","_mnuChBClick","_isSameFilterLR","_currentChannelIndex","_isActualChannelCurveNeeded","_drawCurve","_checkMenu","_mnuChBL","_mnuChBR","_mnuChLRClick","_mnuChL","_mnuChR","_showZones","_mnuShowZones","_editZones","_canvas","classList","_mnuEditZones","_mnuNormalizeCurves","_mnuShowActual","items","_mnu","querySelectorAll","focus","moveFocus","siblingProp","currentElem","HTMLButtonElement","contains","target","_btnMnu","_drawingMode","normX","floor","_widthRatio","normY","_heightRatio","_lastDrawX","_lastDrawY","setPointerCapture","pointerId","_canvasMouseMove","_canvasMouseUp","_documentMouseMove","_documentMouseUp","releasePointerCapture","width","height","abs","delta","inc","count","_wrappedUpdateFilter","_setStatusBar","_fixCanvasSize","createControl","placeholder","_ctx","createLabel","name","content","lbl","createElement","className","clsNS","innerHTML","createMenuSep","setAttribute","createMenuLabel","text","l","textContent","createMenuItem","checkable","checked","clickHandler","type","dataset","appendChild","createTextNode","blur","_element","test","navigator","userAgent","MSStream","add","getComputedStyle","direction","_isRTL","_stb","_canvasMouseDown","_windowResize","ctx","getContext","_lblCursor","_lblCurve","_lblFrequency","_btnMnuClick","_btnMnuKeyDown","_mnuKeyDown","_mnuChBLClick","_mnuChBRClick","_mnuChLClick","_mnuChRClick","_mnuShowZonesClick","_mnuEditZonesClick","_mnuNormalizeCurvesClick","_mnuShowActualClick","destroyControl","_rangeImage","clearTimeout","_barHideTimeout","_formatDB","dB","minimumFractionDigits","maximumFractionDigits","_formatFrequency","frequencyAndEquivalent","_formatFrequencyUnit","mnu","chk","inner","toggle","style","visibility","toString","call","firstChild","pixelRound","middleOffset","canvas","pixelRatio","devicePixelRatio","widthRatio","heightRatio","widthMinus1","fillStyle","fillRect","lineWidth","strokeStyle","beginPath","moveTo","lineTo","stroke","font","textAlign","fillText","clientHeight","display","setTransform","createLinearGradient","addColorStop","_setLabelParam","label","span","querySelector","curveY"],"mappings":"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"}