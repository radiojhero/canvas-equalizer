{"version":3,"file":"CanvasEqualizer.umd.js","sources":["../../src/ts/Common.ts","../../src/ts/FFTNR.ts","../../src/ts/Equalizer.ts","../../src/ts/L10n.ts","../../src/ts/CanvasEqualizer.ts","../../src/ts/index.ts"],"sourcesContent":["/**\n * canvas-equalizer is distributed under the FreeBSD License\n *\n * Copyright (c) 2012-2017 Armando Meziat, Carlos Rafael Gimenes das Neves\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * The views and conclusions contained in the software and documentation are those\n * of the authors and should not be interpreted as representing official policies,\n * either expressed or implied, of the FreeBSD Project.\n *\n * https://github.com/radiojhero/canvas-equalizer\n */\n\n// miscellaneous functions\n\n(function (window: Window) {\n    try {\n        new CustomEvent('test');\n    }\n    catch (e) {\n        return; // no need to polyfill\n    }\n\n    // polyfills DOM4 CustomEvent\n    function MouseEvent(eventType: string, params: MouseEventInit) {\n        params = params || { bubbles: false, cancelable: false };\n        const mouseEvent = document.createEvent('MouseEvent');\n        mouseEvent.initMouseEvent(eventType, params.bubbles!, params.cancelable!, window, 1,\n                                  params.screenX!, params.screenY!, params.clientX!, params.clientY!,\n                                  params.ctrlKey!, params.altKey!, params.shiftKey!, params.metaKey!,\n                                  0, null);\n\n        return mouseEvent;\n    }\n\n    MouseEvent.prototype = Event.prototype;\n\n    (window as any).MouseEvent = MouseEvent;\n})(window);\n\ntype PointerEventShortName = 'down' | 'move' | 'up';\ntype AttachDetachSignature = (observable: EventTarget, eventName: PointerEventShortName,\n                              targetFunction: (e: MouseEvent) => any, capturePhase?: boolean) => void;\n\nlet attachPointer: AttachDetachSignature;\nlet detachPointer: AttachDetachSignature;\n\nfunction wrap(func: any, wrapper: any, tag: string, elem: EventTarget): any {\n    const wrapperTag = `__${tag}_wrapper__`;\n\n    if (!func[wrapperTag]) {\n        func[wrapperTag] = [];\n    }\n\n    unwrap(func, tag, elem);\n    func[wrapperTag].push({ elem, wrapper });\n    return wrapper;\n}\n\nfunction unwrap(func: any, tag: string, elem: EventTarget): any {\n    const wrapperTag = `__${tag}_wrapper__`;\n\n    let ret: any;\n\n    if (func[wrapperTag]) {\n        func[wrapperTag] = func[wrapperTag].filter((entry: { elem: EventTarget, wrapper: any }, i: number) => {\n            if (entry.elem === elem) {\n                ret = entry.wrapper;\n                return false;\n            }\n\n            return true;\n        });\n    }\n\n    return ret;\n}\n\nif ((window as any).PointerEvent) {\n    attachPointer = function (observable: EventTarget, eventName: PointerEventShortName,\n                              targetFunction: (e: MouseEvent) => any, capturePhase?: boolean) {\n        observable.addEventListener(`pointer${eventName}`, targetFunction as EventListener, capturePhase);\n    };\n    detachPointer = function (observable: EventTarget, eventName: PointerEventShortName,\n                              targetFunction: (e: MouseEvent) => any, capturePhase?: boolean) {\n        observable.removeEventListener(`pointer${eventName}`, targetFunction as EventListener, capturePhase);\n    };\n}\nelse if ('ontouchend' in document) {\n    const mappings: any = {\n        down: ['start'],\n        move: ['move'],\n        up: ['end', 'cancel'],\n    };\n    attachPointer = function (observable: EventTarget, eventName: PointerEventShortName,\n                              targetFunction: (e: MouseEvent) => any, capturePhase?: boolean) {\n        const wrapper = (e: TouchEvent) => {\n            const touch = e.changedTouches[0];\n            const pseudoMouse = new MouseEvent(`mouse${eventName}`, {\n                altKey: e.altKey,\n                clientX: touch && touch.clientX || 0,\n                clientY: touch && touch.clientY || 0,\n                ctrlKey: e.ctrlKey,\n                metaKey: e.metaKey,\n                screenX: touch && touch.screenX || 0,\n                screenY: touch && touch.screenY || 0,\n                shiftKey: e.shiftKey,\n            });\n\n            (pseudoMouse as any).clonedFromTouch = true;\n\n            const result = targetFunction(pseudoMouse);\n\n            if (result === false || pseudoMouse.defaultPrevented) {\n                cancelEvent(e);\n            }\n\n            return result;\n        };\n\n        mappings[eventName].forEach((mapping: string) => {\n            observable.addEventListener(`touch${mapping}`,\n                wrap(targetFunction, wrapper, `touch${eventName}`, observable), capturePhase);\n        });\n    };\n    detachPointer = function (observable: EventTarget, eventName: PointerEventShortName,\n                              targetFunction: (e: MouseEvent) => any, capturePhase?: boolean) {\n        mappings[eventName].forEach((mapping: string) => {\n            observable.removeEventListener(`touch${mapping}`,\n                unwrap(targetFunction, `touch${eventName}`, observable), capturePhase);\n        });\n    };\n}\nelse {\n    attachPointer = function (observable: EventTarget, eventName: PointerEventShortName,\n                              targetFunction: (e: MouseEvent) => any, capturePhase?: boolean) {\n        observable.addEventListener(`mouse${eventName}`, targetFunction as EventListener, capturePhase);\n    };\n    detachPointer = function (observable: EventTarget, eventName: PointerEventShortName,\n                              targetFunction: (e: MouseEvent) => any, capturePhase?: boolean) {\n        observable.removeEventListener(`mouse${eventName}`, targetFunction as EventListener, capturePhase);\n    };\n}\n\nconst runningFuncs: (() => void)[] = [];\n\nexport { attachPointer, detachPointer };\n\n/* tslint:disable:no-magic-numbers object-literal-sort-keys */\nexport const keyFix: any = {\n    Backspace: 8,\n    '\\t': ['Tab', 9],\n    '\\n': ['Enter', 13],\n    Escape: 27,\n    End: 35,\n    Home: 36,\n    ArrowLeft: 37,\n    ArrowUp: 38,\n    ArrowRight: 39,\n    ArrowDown: 40,\n    Delete: 46,\n};\n/* tslint:enable:no-magic-numbers object-literal-sort-keys */\n\nexport function keyPressed(e: KeyboardEvent, ...chars: string[]) {\n    for (let i = 0; i < chars.length; i++) {\n        const chr = chars[i];\n        if (Object.keys(keyFix).indexOf(chr) !== -1) {\n            const [key, keyCode] = Array.isArray(keyFix[chr]) ? keyFix[chr] : [chr, keyFix[chr]];\n            if (e.key === key || e.keyCode === keyCode) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\nexport function cancelEvent(e: Event) {\n    e.preventDefault();\n    e.stopPropagation();\n    return false;\n}\n\nexport function throttledFunction(func: () => void, timeout?: number) {\n    if (runningFuncs.indexOf(func) === -1) {\n        runningFuncs.push(func);\n        const wrapper = () => {\n            func();\n            runningFuncs.splice(runningFuncs.indexOf(func), 1);\n        };\n\n        if (timeout) {\n            setTimeout(wrapper, timeout);\n        }\n        else {\n            requestAnimationFrame(wrapper);\n        }\n    }\n}\n\nexport function addThrottledEvent(observable: EventTarget,\n                                  eventName: string,\n                                  targetFunction: (e?: Event) => any,\n                                  capturePhase?: boolean) {\n    let running = false;\n    const wrapper = (e: Event) => {\n        if (!running) {\n            running = true;\n            requestAnimationFrame(() => {\n                targetFunction(e);\n                running = false;\n            });\n        }\n    };\n\n    observable.addEventListener(eventName,\n        wrap(targetFunction, wrapper, `throttle${eventName}`, observable), capturePhase);\n}\n\nexport function removeThrottledEvent(observable: EventTarget,\n                                     eventName: string,\n                                     targetFunction: (e?: Event) => any,\n                                     capturePhase?: boolean) {\n    observable.removeEventListener(eventName,\n        unwrap(targetFunction, `throttle${eventName}`, observable), capturePhase);\n}\n\nexport function elemCoords(elem: HTMLElement, e: MouseEvent): { x: number, y: number } {\n    const rect = elem.getBoundingClientRect();\n    return {\n        x: e.clientX - rect.left,\n        y: e.clientY - rect.top,\n    };\n}\n","/**\n * canvas-equalizer is distributed under the FreeBSD License\n *\n * Copyright (c) 2012-2017 Armando Meziat, Carlos Rafael Gimenes das Neves\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * The views and conclusions contained in the software and documentation are those\n * of the authors and should not be interpreted as representing official policies,\n * either expressed or implied, of the FreeBSD Project.\n *\n * https://github.com/radiojhero/canvas-equalizer\n */\n\n/*==============================================================================\n *\n * This algorithm is an adaptation of the algorithm from the hardcover\n * book \"Numerical Recipes: The Art of Scientific Computing, 3rd Edition\",\n * with some additional optimizations and changes.\n *\n * I HIGHLY recommend this book!!! :D\n *\n *==============================================================================\n */\n\n/* Ordering of data\n * time [0]          | Real [bin 0]\n * time [1]          | Real [bin length/2]\n * time [2]          | Real [bin 1]\n * time [3]          | Imag [bin 1]\n * time [...]        | Real [bin ...]\n * time [...]        | Imag [bin ...]\n * time [length-2]   | Real [bin length/2-1]\n * time [length-1]   | Imag [bin length/2-1]\n */\n\n/* tslint:disable:no-magic-numbers no-bitwise */\n\nexport function FFTComplex(data: Float32Array, n: number, isign: number) {\n    const nn = n << 1;\n    let mmax: number;\n    let m: number;\n    let j = 1;\n    let istep: number;\n    let i: number;\n    let wr: number;\n    let wpr: number;\n    let wpi: number;\n    let wi: number;\n    let theta: number;\n    let tempr: number;\n    let tempi: number;\n    let halfmmax: number;\n    let dj1: number;\n    let dj: number;\n\n    // bit reversal swap\n    for (i = 1; i < nn; i += 2) {\n        if (j > i) {\n            tempr = data[j - 1];\n            data[j - 1] = data[i - 1];\n            data[i - 1] = tempr;\n            tempr = data[j];\n            data[j] = data[i];\n            data[i] = tempr;\n        }\n\n        m = n;\n\n        while (m >= 2 && j > m) {\n            j -= m;\n            m >>>= 1;\n        }\n\n        j += m;\n    }\n\n    // first pass (mmax = 2 / wr = 1 / wi = 0)\n    for (i = 1; i <= nn; i += 4) {\n        j = i + 2;\n        tempr = data[j - 1];\n        tempi = data[j];\n        data[j - 1] = data[i - 1] - tempr;\n        data[j] = data[i] - tempi;\n        data[i - 1] += tempr;\n        data[i] += tempi;\n    }\n\n    /* I decided not to unroll the following steps in favor of the cache memory\n\n    // second pass (mmax = 4 / wr = 1 / wi = 0) A\n    for (i = 1; i <= nn; i += 8) {\n        j = i + 4;\n        tempr = data[j - 1];\n        tempi = data[j];\n        data[j - 1] = data[i - 1] - tempr;\n        data[j] = data[i] - tempi;\n        data[i - 1] += tempr;\n        data[i] += tempi;\n    }\n\n    // second pass (mmax = 4 / wr = 0 / wi = isign) B\n    if (isign === 1) {\n        for (i = 3; i <= nn; i += 8) {\n            j = i + 4;\n            tempr = -data[j];\n            tempi = data[j - 1];\n            data[j - 1] = data[i - 1] - tempr;\n            data[j] = data[i] - tempi;\n            data[i - 1] += tempr;\n            data[i] += tempi;\n        }\n    }\n    else {\n        for (i = 3; i <= nn; i += 8) {\n            j = i + 4;\n            tempr = data[j];\n            tempi = -data[j - 1];\n            data[j - 1] = data[i - 1] - tempr;\n            data[j] = data[i] - tempi;\n            data[i - 1] += tempr;\n            data[i] += tempi;\n        }\n    }\n\n    mmax = 8;\n    theta = isign * Math.PI * 0.25;\n    */\n\n    mmax = 4;\n    theta = isign * Math.PI * 0.5;\n\n    while (nn > mmax) {\n        istep = mmax << 1;\n        wpi = Math.sin(theta);\n        theta *= 0.5;\n        wpr = Math.sin(theta);\n        wpr *= -2.0 * wpr;\n\n        // ---------------------------------------------\n        // special case for the inner loop when m = 1:\n        // wr = 1 / wi = 0\n        for (i = 1; i <= nn; i += istep) {\n            j = i + mmax;\n            tempr = data[j - 1];\n            tempi = data[j];\n            data[j - 1] = data[i - 1] - tempr;\n            data[j] = data[i] - tempi;\n            data[i - 1] += tempr;\n            data[i] += tempi;\n        }\n\n        wr = 1.0 + wpr;\n        wi = wpi;\n        // ---------------------------------------------\n\n        halfmmax = ((mmax >>> 1) + 1);\n\n        for (m = 3; m < halfmmax; m += 2) {\n            for (i = m; i <= nn; i += istep) {\n                j = i + mmax;\n                tempr = (wr * (dj1 = data[j - 1])) - (wi * (dj = data[j]));\n                tempi = (wr * dj) + (wi * dj1);\n                data[j - 1] = data[i - 1] - tempr;\n                data[j] = data[i] - tempi;\n                data[i - 1] += tempr;\n                data[i] += tempi;\n            }\n            wr += ((tempr = wr) * wpr) - (wi * wpi);\n            wi += (wi * wpr) + (tempr * wpi);\n        }\n\n        // ---------------------------------------------\n        // special case for the inner loop when m = ((mmax >>> 1) + 1):\n        // wr = 0 / wi = isign\n        if (isign === 1) {\n            for (i = m; i <= nn; i += istep) {\n                j = i + mmax;\n                tempr = -data[j];\n                tempi = data[j - 1];\n                data[j - 1] = data[i - 1] - tempr;\n                data[j] = data[i] - tempi;\n                data[i - 1] += tempr;\n                data[i] += tempi;\n            }\n            wr = -wpi;\n            wi = 1.0 + wpr;\n        }\n        else {\n            for (i = m; i <= nn; i += istep) {\n                j = i + mmax;\n                tempr = data[j];\n                tempi = -data[j - 1];\n                data[j - 1] = data[i - 1] - tempr;\n                data[j] = data[i] - tempi;\n                data[i - 1] += tempr;\n                data[i] += tempi;\n            }\n            wr = wpi;\n            wi = -1.0 - wpr;\n        }\n\n        m += 2;\n        // ---------------------------------------------\n\n        for (; m < mmax; m += 2) {\n            for (i = m; i <= nn; i += istep) {\n                j = i + mmax;\n                tempr = (wr * (dj1 = data[j - 1])) - (wi * (dj = data[j]));\n                tempi = (wr * dj) + (wi * dj1);\n                data[j - 1] = data[i - 1] - tempr;\n                data[j] = data[i] - tempi;\n                data[i - 1] += tempr;\n                data[i] += tempi;\n            }\n            wr += ((tempr = wr) * wpr) - (wi * wpi);\n            wi += (wi * wpr) + (tempr * wpi);\n        }\n\n        mmax = istep;\n    }\n}\n\nexport function FFTReal(data: Float32Array, n: number, isign: number) {\n    let i: number;\n    let i1: number;\n    let i2: number;\n    let i3: number;\n    let i4: number;\n    let d1: number;\n    let d2: number;\n    let d3: number;\n    let d4: number;\n    const n4 = n >>> 2;\n    let c2: number;\n    let h1r: number;\n    let h1i: number;\n    let h2r: number;\n    let h2i: number;\n    let wr: number;\n    let wi: number;\n    let wpr: number;\n    let wpi: number;\n    let theta = Math.PI / (n >>> 1);\n\n    if (isign === 1) {\n        c2 = -0.5;\n        FFTComplex(data, n >>> 1, 1);\n    }\n    else {\n        c2 = 0.5;\n        theta = -theta;\n    }\n\n    wpr = Math.sin(0.5 * theta);\n    wr = 1.0 + (wpr *= (-2.0 * wpr));\n    wi = (wpi = Math.sin(theta));\n\n    for (i = 1; i < n4; i++) {\n        i2 = 1 + (i1 = (i << 1));\n        i4 = 1 + (i3 = (n - i1));\n        h1r = 0.5 * ((d1 = data[i1]) + (d3 = data[i3]));\n        h1i = 0.5 * ((d2 = data[i2]) - (d4 = data[i4]));\n        h2r = -c2 * (d2 + d4);\n        h2i = c2 * (d1 - d3);\n        data[i1] = h1r + (d1 = (wr * h2r)) - (d2 = (wi * h2i));\n        data[i2] = h1i + (d3 = (wr * h2i)) + (d4 = (wi * h2r));\n        data[i3] = h1r - d1 + d2;\n        data[i4] = d3 + d4 - h1i;\n        wr += ((h1r = wr) * wpr) - (wi * wpi);\n        wi += (wi * wpr) + (h1r * wpi);\n    }\n\n    if (isign === 1) {\n        data[0] = (h1r = data[0]) + data[1];\n        data[1] = h1r - data[1];\n    }\n    else {\n        data[0] = 0.5 * ((h1r = data[0]) + data[1]);\n        data[1] = 0.5 * (h1r - data[1]);\n        FFTComplex(data, n >>> 1, -1);\n        h1r = 2.0 / n;\n\n        for (i = n - 1; i >= 0; i--) {\n            data[i] *= h1r;\n        }\n    }\n}\n","/**\n * canvas-equalizer is distributed under the FreeBSD License\n *\n * Copyright (c) 2012-2017 Armando Meziat, Carlos Rafael Gimenes das Neves\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * The views and conclusions contained in the software and documentation are those\n * of the authors and should not be interpreted as representing official policies,\n * either expressed or implied, of the FreeBSD Project.\n *\n * https://github.com/radiojhero/canvas-equalizer\n */\n\n/* tslint:disable:no-magic-numbers no-bitwise */\n\nimport deepAssign from 'deep-assign';\nimport { FFTReal } from './FFTNR';\nimport IEqualizerOptions from './IEqualizerOptions';\n\nconst defaultOptions: IEqualizerOptions = {\n    validYRangeHeight: 255,\n    visibleBinCount: 512,\n};\n\nexport default class Equalizer {\n\n    private _options: IEqualizerOptions;\n    private _visibleFrequencies: Float32Array;\n    private _equivalentZones: Uint16Array;\n    private _equivalentZonesFrequencyCount: Float32Array;\n    private _zeroChannelValueY: number;\n    public _maximumChannelValue: number;\n    public _minimumChannelValue: number;\n    public _minusInfiniteChannelValue: number;\n    private _maximumChannelValueY: number;\n    private _minimumChannelValueY: number;\n    private _filterLength: number;\n    private _sampleRate: number;\n    private _isNormalized: boolean;\n    public _binCount: number;\n    private _audioContext: AudioContext;\n    private _filterKernel: AudioBuffer;\n    private _convolver: ConvolverNode;\n    private _tmp: Float32Array;\n    private _channelCurves: Int16Array[];\n    private _actualChannelCurve: Int16Array;\n    private _channelIndex: number;\n\n    constructor(filterLength: number, audioContext: AudioContext, options: IEqualizerOptions = {}) {\n        Equalizer._validateFilterLength(filterLength);\n\n        this._options = deepAssign({}, defaultOptions, options);\n        this._filterLength = filterLength;\n        this._sampleRate = audioContext.sampleRate || 44100;\n        this._isNormalized = false;\n        this._binCount = (filterLength >>> 1) + 1;\n        this._audioContext = audioContext;\n        this._filterKernel = audioContext.createBuffer(2, filterLength, this._sampleRate);\n        this._tmp = new Float32Array(filterLength);\n        this._channelCurves = [\n            new Int16Array(this._options.visibleBinCount!), new Int16Array(this._options.visibleBinCount!)];\n        this._actualChannelCurve = new Int16Array(this._options.visibleBinCount!);\n        this._channelIndex = -1;\n\n        this._zeroChannelValueY = this._options.validYRangeHeight! >>> 1;\n        this._maximumChannelValue = this._options.validYRangeHeight! >>> 1;\n        this._minimumChannelValue = -(this._options.validYRangeHeight! >>> 1);\n        this._minusInfiniteChannelValue = -(this._options.validYRangeHeight! >>> 1) - 1;\n        this._maximumChannelValueY = 0;\n        this._minimumChannelValueY = this._options.validYRangeHeight! - 1;\n\n        this._visibleFrequencies = new Float32Array(this._options.visibleBinCount!);\n        this._equivalentZones = new Uint16Array([31, 62, 125, 250, 500, 1000, 2000, 4000, 8000, 16000]);\n\n        /* [0, +9, +9, +18, +35, +36, +70, +72, +72, +72, visibleBinCount] */\n        let eqz = [0, 9, 18, 36, 71, 107, 177, 249, 321, 393, 512];\n        const ratio = this._options.visibleBinCount! / eqz[eqz.length - 1];\n        let freqSteps = [5, 5, 5, 5, 10, 10, 20, 40, 80, 89];\n        const firstFreqs = [5, 50, 95, 185, 360, 720, 1420, 2860, 5740, 11498];\n        let f = firstFreqs[0];\n\n        if (this._options.visibleBinCount! !== eqz[eqz.length - 1]) {\n            eqz = eqz.map((num: number) => Math.round(num * ratio));\n            freqSteps = freqSteps.map((num: number) => num / ratio);\n        }\n\n        this._equivalentZonesFrequencyCount = new Float32Array(eqz);\n\n        for (let i = 0, s = 0; i < this._options.visibleBinCount!; i++) {\n            this._visibleFrequencies[i] = f;\n            if (s !== eqz.length - 1 && s !== firstFreqs.length - 1 && i + 1 >= eqz[s + 1]) {\n                s++;\n                f = firstFreqs[s];\n            }\n            else {\n                f += freqSteps[s];\n            }\n        }\n\n        this.reset();\n        this._convolver = audioContext.createConvolver();\n        this._convolver.normalize = false;\n        this._convolver.buffer = this._filterKernel;\n    }\n\n    public reset() {\n        for (let i = this._options.visibleBinCount! - 1; i >= 0; i--) {\n            this._channelCurves[0][i] = this._zeroChannelValueY;\n            this._channelCurves[1][i] = this._zeroChannelValueY;\n            this._actualChannelCurve[i] = this._zeroChannelValueY;\n        }\n\n        this.updateFilter(true);\n        this.updateActualChannelCurve(0);\n    }\n\n    public clampY(y: number): number {\n        const maxY = this._maximumChannelValueY;\n        const minY = this._minimumChannelValueY;\n\n        return y <= maxY ? maxY : (y > minY ? this._options.validYRangeHeight! + 1 : y);\n    }\n\n    public yToDB(y: number): number {\n        const maxY = this._maximumChannelValueY;\n        const minY = this._minimumChannelValueY;\n\n        return y <= maxY ? 40 : (y > minY ? -Infinity : Equalizer._lerp(maxY, 40, minY, -40, y));\n    }\n\n    public yToMagnitude(y: number): number {\n        // 40dB = 100\n        // -40dB = 0.01\n        // magnitude = 10 ^ (dB/20)\n        // log a (x^p) = p * log a (x)\n        // x^p = a ^ (p * log a (x))\n        // 10^p = e ^ (p * log e (10))\n        const maxY = this._maximumChannelValueY;\n        const minY = this._minimumChannelValueY;\n\n        return y <= maxY ? 100 :\n            (y > minY ? 0 : Math.exp(Equalizer._lerp(maxY, 2, minY, -2, y) * Math.LN10)); // 2 = 40dB/20\n    }\n\n    public magnitudeToY(magnitude: number): number {\n        // 40dB = 100\n        // -40dB = 0.01\n        const zcy = this._zeroChannelValueY;\n\n        return magnitude >= 100\n               ? this._maximumChannelValueY\n               : (magnitude < 0.01\n                  ? this._options.validYRangeHeight! + 1\n                  : Math.round((zcy - (zcy * Math.log(magnitude) / Math.LN10 * 0.5)) - 0.4));\n    }\n\n    public visibleBinToZoneIndex(visibleBinIndex: number): number {\n        if (visibleBinIndex >= (this._options.visibleBinCount! - 1)) {\n            return this._equivalentZones.length - 1;\n        }\n        else if (visibleBinIndex > 0) {\n            const z = this._equivalentZonesFrequencyCount;\n\n            for (let i = z.length - 1; i >= 0; i--) {\n                if (visibleBinIndex >= z[i]) {\n                    return i;\n                }\n            }\n        }\n\n        return 0;\n    }\n\n    public visibleBinToFrequency(visibleBinIndex: number): number {\n        const vf = this._visibleFrequencies;\n        const vbc = this._options.visibleBinCount!;\n\n        if (visibleBinIndex >= vbc - 1) {\n            return vf[vbc - 1];\n        }\n        else if (visibleBinIndex > 0) {\n            return vf[visibleBinIndex];\n        }\n\n        return vf[0];\n    }\n\n    public visibleBinToFrequencyGroup(visibleBinIndex: number): number[] {\n        const ez = this._equivalentZones;\n        const vf = this._visibleFrequencies;\n        const vbc = this._options.visibleBinCount!;\n\n        if (visibleBinIndex >= vbc - 1) {\n            return [Math.round(vf[vbc - 1]), Math.round(ez[ez.length - 1])];\n        }\n        else if (visibleBinIndex > 0) {\n            const ezc = this._equivalentZonesFrequencyCount;\n\n            for (let i = ezc.length - 1; i >= 0; i--) {\n                if (visibleBinIndex >= ezc[i]) {\n                    return [Math.round(vf[visibleBinIndex]), Math.round(ez[i])];\n                }\n            }\n        }\n\n        return [Math.round(vf[0]), Math.round(ez[0])];\n    }\n\n    public changeZoneY(channelIndex: number, x: number, y: number) {\n        let i = this.visibleBinToZoneIndex(x);\n        const ii = this._equivalentZonesFrequencyCount[i + 1];\n        const cy = this.clampY(y);\n        const curve = this._channelCurves[channelIndex];\n\n        for (i = this._equivalentZonesFrequencyCount[i]; i < ii; i++) {\n            curve[i] = cy;\n        }\n    }\n\n    private _updateBuffer() {\n        if (this._options.convolverCallback) {\n            const oldConvolver = this._convolver;\n            this._convolver = this.audioContext.createConvolver();\n            this._convolver.normalize = false;\n            this._convolver.buffer = this._filterKernel;\n            this._options.convolverCallback(oldConvolver, this._convolver);\n        } else {\n            this._convolver.buffer = this._filterKernel;\n        }\n    }\n\n    public copyFilter(sourceChannel: number, destinationChannel: number) {\n        const src = this._filterKernel.getChannelData(sourceChannel);\n        const dst = this._filterKernel.getChannelData(destinationChannel);\n\n        for (let i = (this._filterLength - 1); i >= 0; i--) {\n            dst[i] = src[i];\n        }\n\n        if (this._convolver) {\n            this._updateBuffer();\n        }\n    }\n\n    public updateFilter(updateBothChannels: boolean) {\n        const channelIndex = Math.max(this._channelIndex, 0);\n        const isSameFilterLR = channelIndex === -1;\n        const filterLength = this._filterLength;\n        const curve = this._channelCurves[channelIndex];\n        const valueCount = this._options.visibleBinCount!;\n        const bw = this._sampleRate / filterLength;\n        const filterLength2 = (filterLength >>> 1);\n        const filter = this._filterKernel.getChannelData(channelIndex);\n        const _visibleFrequencies = this._visibleFrequencies;\n        /* M = filterLength2, so, M_HALF_PI_FFTLEN2 = (filterLength2 * 0.5 * Math.PI) / filterLength2 */\n        const M_HALF_PI_FFTLEN2 = 0.5 * Math.PI;\n        let invMaxMag = 1;\n        let repeat = Number(this._isNormalized) + 1;\n\n        // fill in all filter points, either averaging or interpolating them as necessary\n        do {\n            repeat--;\n            let i = 1;\n            let ii = 0;\n\n            // tslint:disable-next-line:no-constant-condition\n            while (true) {\n                const freq = bw * i;\n\n                if (freq >= _visibleFrequencies[0]) {\n                    break;\n                }\n\n                const mag = this.yToMagnitude(curve[0]);\n                filter[i << 1] = mag * invMaxMag;\n                i++;\n            }\n\n            while (bw > _visibleFrequencies[ii + 1] - _visibleFrequencies[ii] &&\n                   i < filterLength2 && ii < valueCount - 1) {\n                const freq = bw * i;\n                let avg = 0;\n                let avgCount = 0;\n\n                do {\n                    avg += curve[ii];\n                    avgCount++;\n                    ii++;\n                } while (freq > _visibleFrequencies[ii] && ii < valueCount - 1);\n\n                const mag = this.yToMagnitude(avg / avgCount);\n                filter[i << 1] = mag * invMaxMag;\n                i++;\n            }\n\n            for (; i < filterLength2; i++) {\n                const freq = bw * i;\n                let mag: number;\n\n                if (freq >= _visibleFrequencies[valueCount - 1]) {\n                    mag = this.yToMagnitude(curve[valueCount - 1]);\n                }\n                else {\n                    while (ii < (valueCount - 1) && freq > _visibleFrequencies[ii + 1]) {\n                        ii++;\n                    }\n\n                    mag = this.yToMagnitude(\n                        Equalizer._lerp(_visibleFrequencies[ii], curve[ii],\n                                       _visibleFrequencies[ii + 1], curve[ii + 1], freq));\n                }\n                filter[i << 1] = mag * invMaxMag;\n            }\n            // since DC and Nyquist are purely real, do not bother with them in the for loop,\n            // just make sure neither one has a gain greater than 0 dB\n            filter[0] = (filter[2] >= 1 ? 1 : filter[2]);\n            filter[1] = (filter[filterLength - 2] >= 1 ? 1 : filter[filterLength - 2]);\n\n            // convert the coordinates from polar to rectangular\n            for (i = filterLength - 2; i >= 2; i -= 2) {\n                /*                -k.j\n                 * polar = Mag . e\n                 *\n                 * where:\n                 * k = (M / 2) * pi * i / (fft length / 2)\n                 * i = index varying from 0 to (fft length / 2)\n                 *\n                 * rectangular:\n                 * real = Mag . cos(-k)\n                 * imag = Mag . sin(-k)\n                 */\n                const k = M_HALF_PI_FFTLEN2 * (i >>> 1);\n                /* ****NOTE:\n                 * when using FFTReal ou FFTNR, k MUST BE passed as the argument of sin and cos, due to the\n                 * signal of the imaginary component\n                 * RFFT, intel and other fft's use the opposite signal... therefore, -k MUST BE passed!!\n                 */\n                filter[i + 1] = (filter[i] * Math.sin(k));\n                filter[i] *= Math.cos(k);\n            }\n\n            FFTReal(filter, filterLength, -1);\n\n            if (repeat) {\n                // get the actual filter response, and then, compensate\n                invMaxMag = this._applyWindowAndComputeActualMagnitudes(filter);\n\n                if (invMaxMag <= 0) {\n                    repeat = 0;\n                }\n\n                invMaxMag = 1.0 / invMaxMag;\n            }\n        } while (repeat);\n\n        if (isSameFilterLR) {\n            // copy the filter to the other channel\n            this.copyFilter(channelIndex, 1 - channelIndex);\n            return;\n        }\n\n        if (updateBothChannels) {\n            // update the other channel as well\n            const oldChannelIndex = this._channelIndex;\n\n            this._channelIndex = 1 - channelIndex;\n            this.updateFilter(false);\n            this._channelIndex = oldChannelIndex;\n            return;\n        }\n\n        if (this._convolver) {\n            this._updateBuffer();\n        }\n    }\n\n    public updateActualChannelCurve(channelIndex: number) {\n        const filterLength = this._filterLength;\n        const curve = this._actualChannelCurve;\n        const valueCount = this._options.visibleBinCount!;\n        const bw = this._sampleRate / filterLength;\n        const filterLength2 = (filterLength >>> 1);\n        const tmp = this._tmp;\n        const _visibleFrequencies = this._visibleFrequencies;\n        const filter = this._filterKernel.getChannelData(channelIndex);\n\n        this._applyWindowAndComputeActualMagnitudes(filter);\n\n        // tmp now contains (filterLength2 + 1) magnitudes\n        let i = 0;\n        let ii = 0;\n\n        while (ii < valueCount - 1 && i < filterLength2 && bw > _visibleFrequencies[ii + 1] - _visibleFrequencies[ii]) {\n            let freq = bw * i;\n\n            while (i < filterLength2 && freq + bw < _visibleFrequencies[ii]) {\n                i++;\n                freq = bw * i;\n            }\n\n            curve[ii] = this.magnitudeToY(\n                Equalizer._lerp(freq, tmp[i], freq + bw, tmp[i + 1], _visibleFrequencies[ii]));\n            ii++;\n        }\n\n        i++;\n\n        while (i < filterLength2 && ii < valueCount) {\n            let freq: number;\n            let avg = 0;\n            let avgCount = 0;\n\n            do {\n                avg += tmp[i];\n                avgCount++;\n                i++;\n                freq = bw * i;\n            } while (freq < _visibleFrequencies[ii] && i < filterLength2);\n\n            curve[ii] = this.magnitudeToY(avg / avgCount);\n            ii++;\n        }\n\n        i = (this._sampleRate >>> 1) >= _visibleFrequencies[valueCount - 1]\n            ? curve[ii - 1]\n            : this._options.validYRangeHeight! + 1;\n\n        for (; ii < valueCount; ii++) {\n            curve[ii] = i;\n        }\n    }\n\n    private _applyWindowAndComputeActualMagnitudes(filter: Float32Array): number {\n        const filterLength = this._filterLength;\n        const tmp = this._tmp;\n        const filterLength2 = (filterLength >>> 1);\n        const M = filterLength2;\n        const PI2_M = 2 * Math.PI / M;\n\n        // it is not possible to know what kind of window the browser will use,\n        // so make an assumption here... Blackman window!\n        // ...at least it is the one I used, back in C++ times :)\n        for (let i = M; i >= 0; i--) {\n            /* Hanning window */\n            // tmp[i] = filter[i] * (0.5 - (0.5 * cos(PI2_M * i)));\n            /* Hamming window */\n            // tmp[i] = filter[i] * (0.54 - (0.46 * cos(PI2_M * i)));\n            /* Blackman window */\n            tmp[i] = filter[i] * (0.42 - (0.5 * Math.cos(PI2_M * i)) + (0.08 * Math.cos(2 * PI2_M * i)));\n        }\n\n        for (let i = filterLength - 1; i > M; i--) {\n            tmp[i] = 0;\n        }\n\n        // calculate the spectrum\n        FFTReal(tmp, filterLength, 1);\n        // save Nyquist for later\n        const ii = tmp[1];\n        let maxMag = (tmp[0] > ii ? tmp[0] : ii);\n\n        for (let i = 2; i < filterLength; i += 2) {\n            const rval = tmp[i];\n            const ival = tmp[i + 1];\n            const mag = Math.sqrt((rval * rval) + (ival * ival));\n\n            tmp[i >>> 1] = mag;\n            if (mag > maxMag) {\n                maxMag = mag;\n            }\n        }\n\n        // restore Nyquist in its new position\n        tmp[filterLength2] = ii;\n        return maxMag;\n    }\n\n    private static _validateFilterLength(filterLength: number) {\n        if (filterLength < 8 || (filterLength & (filterLength - 1))) {\n            throw new Error('The FFT size must be power of 2 and not less than 8.');\n        }\n    }\n\n    private static _lerp(x0: number, y0: number, x1: number, y1: number, x: number): number {\n        return ((x - x0) * (y1 - y0) / (x1 - x0)) + y0;\n    }\n\n    // virtual properties\n\n    get filterLength(): number {\n        return this._filterLength;\n    }\n\n    set filterLength(newFilterLength: number) {\n        if (this._filterLength !== newFilterLength) {\n            Equalizer._validateFilterLength(newFilterLength);\n            this._filterLength = newFilterLength;\n            this._binCount = (newFilterLength >>> 1) + 1;\n            this._filterKernel = this._audioContext.createBuffer(2, newFilterLength, this._sampleRate);\n            this._tmp = new Float32Array(newFilterLength);\n            this.updateFilter(true);\n        }\n    }\n\n    get sampleRate(): number {\n        return this._sampleRate;\n    }\n\n    set sampleRate(newSampleRate: number) {\n        if (this.sampleRate !== newSampleRate) {\n            this._sampleRate = newSampleRate;\n            this._filterKernel = this._audioContext.createBuffer(2, this._filterLength, newSampleRate);\n            this.updateFilter(true);\n        }\n    }\n\n    get isNormalized(): boolean {\n        return this._isNormalized;\n    }\n\n    set isNormalized(isNormalized: boolean) {\n        if (this.isNormalized !== isNormalized) {\n            this._isNormalized = isNormalized;\n            this.updateFilter(true);\n        }\n    }\n\n    get audioContext(): AudioContext {\n        return this._audioContext;\n    }\n\n    set audioContext(newAudioContext: AudioContext) {\n        if (this.audioContext !== newAudioContext) {\n            const oldConvolver = this._convolver;\n            this._convolver.disconnect(0);\n            this._audioContext = newAudioContext;\n            this._filterKernel = newAudioContext.createBuffer(2, this._filterLength, this._sampleRate);\n            (this._convolver as any) = null;\n            this.updateFilter(true);\n            this._convolver = newAudioContext.createConvolver();\n            this._convolver.normalize = false;\n            this._convolver.buffer = this._filterKernel;\n            if (this._options.convolverCallback) {\n                this._options.convolverCallback(oldConvolver, this._convolver);\n            }\n        }\n    }\n\n    get options(): IEqualizerOptions {\n        return deepAssign({}, defaultOptions, this._options);\n    }\n\n    get visibleFrequencies(): Float32Array {\n        return this._visibleFrequencies;\n    }\n\n    get channelCurves(): Int16Array[] {\n        return this._channelCurves.slice();\n    }\n\n    get actualChannelCurve(): Int16Array {\n        return this._actualChannelCurve;\n    }\n\n    get convolver(): ConvolverNode {\n        return this._convolver;\n    }\n\n    get channelIndex(): number {\n        return this._channelIndex;\n    }\n\n    get zeroChannelValueY(): number {\n        return this._zeroChannelValueY;\n    }\n\n    get equivalentZonesFrequencyCount(): Float32Array {\n        return this._equivalentZonesFrequencyCount;\n    }\n\n    set channelIndex(newChannelIndex: number) {\n        this._channelIndex = newChannelIndex;\n    }\n}\n","/**\n * canvas-equalizer is distributed under the FreeBSD License\n *\n * Copyright (c) 2012-2017 Armando Meziat, Carlos Rafael Gimenes das Neves\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * The views and conclusions contained in the software and documentation are those\n * of the authors and should not be interpreted as representing official policies,\n * either expressed or implied, of the FreeBSD Project.\n *\n * https://github.com/radiojhero/canvas-equalizer\n */\n\nimport defaultLocale from '../locales/en.json';\n\nimport ILocale from './ILocale';\n\ninterface ILocaleSet {\n    [langId: string]: ILocale;\n}\n\nconst defaultLanguage = 'en';\n\nexport default class L10n {\n\n    private _language: string;\n    private _locales: ILocaleSet = {};\n\n    constructor(language: string = defaultLanguage) {\n        this._language = language;\n        this.loadLocale(defaultLanguage, defaultLocale);\n    }\n\n    public loadLocale(language: string, locale: ILocale) {\n        this._locales[language] = locale;\n    }\n\n    public get(tag: string) {\n        let locales = this._locales[this._language] || this._locales[defaultLanguage];\n\n        if (locales[tag] === undefined) {\n            locales = this._locales[defaultLanguage];\n        }\n\n        return locales[tag];\n    }\n\n    public format(str: string, ...args: any[]): string {\n        str = this.get(str);\n        args.forEach((arg: any, i: number) => {\n            str = str.replace(new RegExp(`\\\\{${i}\\\\}`, 'g'), arg.toLocaleString(this._language));\n        });\n\n        return str;\n    }\n\n    get language(): string {\n        return this._language;\n    }\n\n    set language(language: string) {\n        this._language = language;\n    }\n}\n","/**\n * canvas-equalizer is distributed under the FreeBSD License\n *\n * Copyright (c) 2012-2017 Armando Meziat, Carlos Rafael Gimenes das Neves\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * The views and conclusions contained in the software and documentation are those\n * of the authors and should not be interpreted as representing official policies,\n * either expressed or implied, of the FreeBSD Project.\n *\n * https://github.com/radiojhero/canvas-equalizer\n */\n\nimport deepAssign from 'deep-assign';\n\nimport {\n    keyPressed,\n    elemCoords,\n    attachPointer, detachPointer, cancelEvent,\n    throttledFunction, addThrottledEvent, removeThrottledEvent,\n} from './Common';\n\nimport Equalizer from './Equalizer';\nimport L10n from './L10n';\n\nimport ICanvasEqualizerOptions from './ICanvasEqualizerOptions';\nimport ILocale from './ILocale';\n\nconst defaultOptions: ICanvasEqualizerOptions = {\n    classNamespace: 'GE',\n    filterOptions: {},\n    updateFilterOnDrag: true,\n};\n\nexport default class CanvasEqualizer {\n\n    private _options: ICanvasEqualizerOptions;\n    private _filter: Equalizer;\n    private _element: HTMLElement;\n    private _canvas: HTMLCanvasElement;\n    private _ctx: CanvasRenderingContext2D;\n    private _rangeImage: CanvasGradient;\n    private _btnMnu: HTMLButtonElement;\n    private _mnu: HTMLElement;\n    private _mnuChBL: HTMLButtonElement;\n    private _mnuChL: HTMLButtonElement;\n    private _mnuChBR: HTMLButtonElement;\n    private _mnuChR: HTMLButtonElement;\n    private _mnuShowZones: HTMLButtonElement;\n    private _mnuEditZones: HTMLButtonElement;\n    private _mnuNormalizeCurves: HTMLButtonElement;\n    private _mnuShowActual: HTMLButtonElement;\n    private _lblCursor: HTMLElement;\n    private _lblCurve: HTMLElement;\n    private _lblFrequency: HTMLElement;\n    private _stb: HTMLElement;\n    private _showZones = false;\n    private _editZones = false;\n    private _isActualChannelCurveNeeded = true;\n    private _currentChannelIndex = 0;\n    private _isSameFilterLR = true;\n    private _drawingMode = 0;\n    private _lastDrawX = 0;\n    private _lastDrawY = 0;\n    private _barHideTimeout: number;\n    private _l10n: L10n;\n    private _isRTL = false;\n\n    constructor(filterLength: number, audioContext: AudioContext, options: ICanvasEqualizerOptions = {}) {\n        this._options = deepAssign({}, defaultOptions, options);\n        this._filter = new Equalizer(filterLength, audioContext, this._options.filterOptions);\n        this._l10n = new L10n(this._options.language);\n    }\n\n    public createControl(placeholder: HTMLElement): HTMLCanvasElement {\n        if (!this._ctx) {\n            const createLabel = (name: string, content: string) => {\n                const lbl = document.createElement('div');\n                lbl.className = `${clsNS}LBL ${clsNS}LBL${name}`;\n                lbl.innerHTML = this._l10n.get(content);\n                return lbl;\n            };\n            const createMenuSep = () => {\n                const s = document.createElement('div');\n                s.className = `${clsNS}MNUSEP`;\n                s.setAttribute('role', 'separator');\n                return s;\n            };\n            const createMenuLabel = (text: string) => {\n                const l = document.createElement('div');\n                l.className = `${clsNS}MNULBL`;\n                l.textContent = this._l10n.get(text);\n                return l;\n            };\n            const createMenuItem = (text: string, checkable: boolean | string, checked: boolean,\n                                    clickHandler: (e: MouseEvent) => any) => {\n                const i = document.createElement('button');\n                i.type = 'button';\n                i.className = `${clsNS}MNUIT ${clsNS}CLK`;\n\n                if (checkable) {\n                    if (typeof checkable === 'string') {\n                        i.dataset['radioGroup'] = checkable;\n                        i.setAttribute('role', 'menuitemradio');\n                    }\n                    else {\n                        i.setAttribute('role', 'menuitemcheckbox');\n                    }\n\n                    const s = document.createElement('span');\n                    s.textContent = typeof checkable === 'string' ? ' ' : ' ';\n                    i.appendChild(s);\n                    this._checkMenu(i, checked);\n                }\n                else {\n                    i.setAttribute('role', 'menuitem');\n                }\n\n                i.appendChild(document.createTextNode(this._l10n.get(text)));\n\n                if (clickHandler) {\n                    i.addEventListener('click', clickHandler);\n                }\n\n                i.addEventListener('mouseenter', () => {\n                    i.focus();\n                });\n                i.addEventListener('mouseleave', () => {\n                    i.blur();\n                });\n\n                return i;\n            };\n            const clsNS = this._options.classNamespace!;\n\n            this._element = placeholder;\n            placeholder.className = clsNS;\n\n            if (/\\bip(?:[ao]d|hone)\\b/i.test(navigator.userAgent) && !(window as any).MSStream) {\n                placeholder.classList.add(`${clsNS}IOS`);\n            }\n\n            if (getComputedStyle(placeholder).direction === 'rtl') {\n                placeholder.classList.add('RTL');\n                this._isRTL = true;\n            }\n\n            placeholder.addEventListener('contextmenu', cancelEvent);\n\n            this._stb = document.createElement('div');\n            this._stb.className = `${clsNS}STB`;\n            placeholder.appendChild(this._stb);\n\n            this._canvas = document.createElement('canvas');\n            this._canvas.className = `${clsNS}CNV`;\n            attachPointer(this._canvas, 'down', this._canvasMouseDown);\n            attachPointer(this._canvas, 'move', this._canvasMouseMove);\n            attachPointer(this._canvas, 'up', this._canvasMouseUp);\n            this._canvas.addEventListener('contextmenu', cancelEvent);\n            placeholder.appendChild(this._canvas);\n            addThrottledEvent(window, 'resize', this._windowResize);\n\n            const ctx = this._canvas.getContext('2d');\n\n            if (!ctx) {\n                throw new Error('Unable to get a 2D context.');\n            }\n\n            this._ctx = ctx;\n\n            this._stb.appendChild(this._lblCursor = createLabel('CSR', 'cursor.label'));\n            this._stb.appendChild(this._lblCurve = createLabel('CRV', 'curve.label'));\n            this._stb.appendChild(this._lblFrequency = createLabel('FRQ', 'frequency.label'));\n            this._setStatusBar(0, this._filter.zeroChannelValueY, this._filter.zeroChannelValueY);\n\n            this._btnMnu = document.createElement('button');\n            this._btnMnu.type = 'button';\n            this._btnMnu.className = `${clsNS}BTN ${clsNS}CLK`;\n            this._btnMnu.setAttribute('aria-haspopup', 'true');\n            this._btnMnu.setAttribute('aria-label', this._l10n.get('menu'));\n            this._btnMnu.addEventListener('click', this._btnMnuClick);\n            this._btnMnu.addEventListener('keydown', this._btnMnuKeyDown);\n            this._btnMnu.addEventListener('mouseenter', () => {\n                this._btnMnu.focus();\n            });\n            this._btnMnu.addEventListener('mouseleave', () => {\n                this._btnMnu.blur();\n            });\n            this._stb.appendChild(this._btnMnu);\n\n            this._mnu = document.createElement('div');\n            this._mnu.className = `${clsNS}MNU`;\n            this._mnu.setAttribute('role', 'menu');\n            this._mnu.addEventListener('keydown', this._mnuKeyDown);\n            this._mnu.appendChild(createMenuLabel('menu.both'));\n            this._mnu.appendChild(this._mnuChBL =\n                createMenuItem('menu.both.left', 'curve', true, this._mnuChBLClick));\n            this._mnu.appendChild(this._mnuChBR =\n                createMenuItem('menu.both.right', 'curve', false, this._mnuChBRClick));\n            this._mnu.appendChild(createMenuSep());\n            this._mnu.appendChild(createMenuLabel('menu.one'));\n            this._mnu.appendChild(this._mnuChL =\n                createMenuItem('menu.one.left', 'curve', false, this._mnuChLClick));\n            this._mnu.appendChild(this._mnuChR =\n                createMenuItem('menu.one.right', 'curve', false, this._mnuChRClick));\n            this._mnu.appendChild(createMenuSep());\n            this._mnu.appendChild(this._mnuShowZones =\n                createMenuItem('menu.zones', true, false, this._mnuShowZonesClick));\n            this._mnu.appendChild(this._mnuEditZones =\n                createMenuItem('menu.zoneEdit', true, false, this._mnuEditZonesClick));\n            this._mnu.appendChild(createMenuSep());\n            this._mnu.appendChild(this._mnuNormalizeCurves =\n                createMenuItem('menu.normalizeCurves', true, false, this._mnuNormalizeCurvesClick));\n            this._mnu.appendChild(this._mnuShowActual =\n                createMenuItem('menu.actualResponse', true, true, this._mnuShowActualClick));\n            this._stb.appendChild(this._mnu);\n            this._toggleMenu(false);\n\n            this._fixCanvasSize();\n            this._drawCurve();\n        }\n        return this._canvas;\n    }\n\n    public destroyControl() {\n        if (this._ctx) {\n            removeThrottledEvent(window, 'resize', this._windowResize);\n            delete this._canvas;\n            delete this._lblCursor;\n            delete this._lblCurve;\n            delete this._lblFrequency;\n            delete this._btnMnu;\n            delete this._mnu;\n            delete this._mnuChBL;\n            delete this._mnuChL;\n            delete this._mnuChBR;\n            delete this._mnuChR;\n            delete this._mnuShowZones;\n            delete this._mnuEditZones;\n            delete this._mnuNormalizeCurves;\n            delete this._mnuShowActual;\n            delete this._stb;\n            delete this._ctx;\n            delete this._rangeImage;\n            this._element.innerHTML = '';\n            delete this._element;\n            clearTimeout(this._barHideTimeout);\n        }\n    }\n\n    public reset() {\n        this._filter.reset();\n        this._drawCurve();\n    }\n\n    public loadLocale(language: string, locale: ILocale) {\n        this._l10n.loadLocale(language, locale);\n    }\n\n    /* tslint:disable:no-magic-numbers */\n    private _formatDB(dB: number): string {\n        if (dB < -40) {\n            dB = -Infinity;\n        }\n\n        const ret = dB.toLocaleString(this._l10n.language, { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n        return dB < 0 ? ret.replace('-', '') : (dB === 0 ? '' + ret : '+' + ret);\n    }\n\n    private _formatFrequencyUnit = (frequency: number, compact: boolean): string => {\n        let unit = 'Hz';\n\n        if (compact) {\n            if (frequency >= 1000) {\n                unit = 'k' + unit;\n                frequency = frequency / 1000;\n            }\n        }\n\n        return this._l10n.format('frequency.format', frequency, this._l10n.get(`frequency.unit.${unit}`));\n    }\n\n    private _formatFrequency(frequencyAndEquivalent: number[]): string {\n        return this._l10n.format('frequency.text',\n            ...frequencyAndEquivalent.map((frequency: number, i: number) => this._formatFrequencyUnit(frequency, !!i)));\n    }\n    /* tslint:enable:no-magic-numbers */\n\n    private _checkMenu(mnu: HTMLButtonElement, chk: boolean) {\n\n        function inner(elem: HTMLElement, toggle: boolean) {\n            if (elem) {\n                elem.style.visibility = toggle ? 'visible' : 'hidden';\n                elem.setAttribute('aria-checked', toggle.toString());\n            }\n        }\n\n        if (chk && mnu.dataset['radioGroup']) {\n            [].slice.call(this._mnu.querySelectorAll(`[data-radio-group=\"${mnu.dataset['radioGroup']}\"]`))\n                .forEach((elem: HTMLButtonElement) => {\n                    inner(elem.firstChild as HTMLElement, false);\n                });\n        }\n\n        inner(mnu.firstChild as HTMLElement, chk);\n    }\n\n    private _drawCurve() {\n        /* tslint:disable:no-magic-numbers */\n        // all the 0.5's here are because of this explanation:\n        // http://stackoverflow.com/questions/195262/can-i-turn-off-antialiasing-on-an-html-canvas-element\n        // \"Draw your 1-pixel lines on coordinates like ctx.lineTo(10.5, 10.5). Drawing a one-pixel line\n        // over the point (10, 10) means, that this 1 pixel at that position reaches from 9.5 to 10.5 which\n        // results in two lines that get drawn on the canvas.\n        function pixelRound(x: number): number {\n            return Math.round(x) + middleOffset;\n        }\n\n        const ctx = this._ctx;\n        const canvas = this._canvas;\n        const pixelRatio = window.devicePixelRatio;\n        const width = canvas.width / pixelRatio;\n        const height = canvas.height / pixelRatio;\n        const widthRatio = this._widthRatio();\n        const heightRatio = this._heightRatio();\n        const widthMinus1 = this._filter.options.visibleBinCount! - 1;\n        const middleOffset = 0.5;\n        let curve = this._filter.channelCurves[this._currentChannelIndex];\n\n        if (!ctx) {\n            return false;\n        }\n\n        ctx.fillStyle = '#303030';\n        ctx.fillRect(0, 0, width, height);\n        ctx.lineWidth = 1;\n        ctx.strokeStyle = '#5a5a5a';\n        ctx.beginPath();\n        let x = width + 1 + middleOffset;\n        let y = pixelRound(this._filter.zeroChannelValueY * heightRatio);\n        ctx.moveTo(x, y);\n\n        while (x > 0) {\n            ctx.lineTo(x - 4, y);\n            x -= 10;\n            ctx.moveTo(x, y);\n        }\n\n        ctx.stroke();\n        ctx.font = 'bold 10pt Verdana';\n        ctx.textAlign = this._isRTL ? 'left' : 'right';\n        ctx.fillStyle = '#5a5a5a';\n        ctx.fillText('\\u200e0dB', this._isRTL ? 1 : width - 1,\n            Math.round(this._filter.zeroChannelValueY * heightRatio) - 2);\n        ctx.beginPath();\n        x = width - 1 - middleOffset;\n        y = pixelRound(this._filter.options.validYRangeHeight! * heightRatio);\n        ctx.moveTo(x, y);\n\n        while (x > 0) {\n            ctx.lineTo(x - 4, y);\n            x -= 10;\n            ctx.moveTo(x, y);\n        }\n\n        ctx.stroke();\n        ctx.fillText('\\u200edB', this._isRTL ? 1 : width - 1,\n            Math.round(this._filter.options.validYRangeHeight! * heightRatio) - 2);\n\n        if (this._showZones) {\n            for (let i = this._filter.equivalentZonesFrequencyCount.length - 2; i > 0; i--) {\n                x = pixelRound(this._filter.equivalentZonesFrequencyCount[i] * widthRatio);\n                y = 0;\n                ctx.beginPath();\n                ctx.moveTo(x, y);\n\n                while (y < height) {\n                    ctx.lineTo(x, y + 4);\n                    y += 10;\n                    ctx.moveTo(x, y);\n                }\n\n                ctx.stroke();\n            }\n        }\n\n        ctx.strokeStyle = this._isActualChannelCurveNeeded && !this._drawingMode ? '#707070' : this._rangeImage;\n        ctx.beginPath();\n        ctx.moveTo(0.5, pixelRound(curve[0] * heightRatio));\n\n        for (x = 1; x < widthMinus1; x++) {\n            ctx.lineTo(pixelRound(x * widthRatio), pixelRound(curve[x] * heightRatio));\n        }\n\n        // just to fill up the last pixel!\n        ctx.lineTo(Math.round(x * widthRatio) + 1, pixelRound(curve[x] * heightRatio));\n        ctx.stroke();\n\n        if (this._isActualChannelCurveNeeded && !this._drawingMode) {\n            curve = this._filter.actualChannelCurve;\n            ctx.strokeStyle = this._rangeImage;\n            ctx.beginPath();\n            ctx.moveTo(middleOffset, pixelRound(curve[0] * heightRatio));\n\n            for (x = 1; x < widthMinus1; x++) {\n                ctx.lineTo(pixelRound(x * widthRatio),\n                    pixelRound(curve[x] * heightRatio));\n            }\n\n            // just to fill up the last pixel!\n            ctx.lineTo(Math.round(x * widthRatio) + 1, pixelRound(curve[x] * heightRatio));\n            ctx.stroke();\n        }\n\n        return true;\n        /* tslint:enable:no-magic-numbers */\n    }\n\n    private _widthRatio(): number {\n        return this._canvas.width / window.devicePixelRatio / this._filter.options.visibleBinCount!;\n    }\n\n    private _heightRatio(): number {\n        const height = this._stb.clientHeight;\n        // tslint:disable-next-line:no-magic-numbers\n        return (this._canvas.height / window.devicePixelRatio - height - 5) / this._filter.options.validYRangeHeight!;\n    }\n\n    private _fixCanvasSize() {\n        this._canvas.style.display = 'none';\n        const rect = this._element.getBoundingClientRect();\n        const pixelRatio = window.devicePixelRatio;\n        this._canvas.style.display = '';\n        this._canvas.style.width = rect.width + 'px';\n        this._canvas.style.height = rect.height + 'px';\n        this._canvas.width = rect.width * pixelRatio;\n        this._canvas.height = rect.height * pixelRatio;\n\n        this._ctx.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n\n        /* tslint:disable:no-magic-numbers */\n        this._rangeImage = this._ctx.createLinearGradient(0, 0, 0, rect.height - this._stb.clientHeight - 5);\n        this._rangeImage.addColorStop(0, '#ff0000');\n        this._rangeImage.addColorStop(0.1875, '#ffff00');\n        this._rangeImage.addColorStop(0.39453125, '#00ff00');\n        this._rangeImage.addColorStop(0.60546875, '#00ffff');\n        this._rangeImage.addColorStop(0.796875, '#0000ff');\n        this._rangeImage.addColorStop(1, '#ff00ff');\n        /* tslint:enable:no-magic-numbers */\n\n        this._drawCurve();\n    }\n\n    private _wrappedUpdateFilter = () => {\n        this._filter.updateFilter(false);\n    }\n\n    private _setLabelParam(label: HTMLElement, text: string) {\n        const span = label.querySelector('span');\n\n        if (span) {\n            span.textContent = text;\n        }\n    }\n\n    private _setStatusBar(x: number, y: number, curveY: number) {\n        this._setLabelParam(this._lblCursor, this._formatDB(this._filter.yToDB(y)));\n        this._setLabelParam(this._lblCurve, this._formatDB(this._filter.yToDB(curveY)));\n        this._setLabelParam(this._lblFrequency, this._formatFrequency(this._filter.visibleBinToFrequencyGroup(x)));\n    }\n\n    private _toggleMenu(toggle?: boolean) {\n        toggle = toggle === undefined ? this._mnu.style.display === 'none' : toggle;\n\n        this._mnu.style.display = toggle ? '' : 'none';\n        this._btnMnu.textContent = toggle ? '' : '';\n    }\n\n    // events\n\n    private _btnMnuClick = (e: MouseEvent) => {\n        if (!e.button) {\n            this._toggleMenu();\n        }\n    }\n\n    private _mnuChBLClick = (e: MouseEvent) => {\n        this._mnuChBClick(e, 0);\n    }\n\n    private _mnuChBRClick = (e: MouseEvent) => {\n        this._mnuChBClick(e, 1);\n    }\n\n    private _mnuChBClick = (e: MouseEvent, channelIndex: number) => {\n        if (!e.button) {\n            if (!this._isSameFilterLR || this._currentChannelIndex !== channelIndex) {\n                if (this._isSameFilterLR) {\n                    this._currentChannelIndex = channelIndex;\n                    this._filter.channelIndex = -1;\n                    this._filter.updateFilter(true);\n\n                    if (this._isActualChannelCurveNeeded) {\n                        this._filter.updateActualChannelCurve(channelIndex);\n                    }\n\n                    this._drawCurve();\n                }\n                else {\n                    this._isSameFilterLR = true;\n                    this._filter.copyFilter(channelIndex, 1 - channelIndex);\n                    if (this._currentChannelIndex !== channelIndex) {\n                        this._currentChannelIndex = channelIndex;\n\n                        if (this._isActualChannelCurveNeeded) {\n                            this._filter.updateActualChannelCurve(channelIndex);\n                        }\n\n                        this._drawCurve();\n                    }\n                }\n\n                this._checkMenu(this._mnuChBL, channelIndex === 0);\n                this._checkMenu(this._mnuChBR, channelIndex === 1);\n            }\n        }\n    }\n\n    private _mnuChLClick = (e: MouseEvent) => {\n        this._mnuChLRClick(e, 0);\n    }\n\n    private _mnuChRClick = (e: MouseEvent) => {\n        this._mnuChLRClick(e, 1);\n    }\n\n    private _mnuChLRClick = (e: MouseEvent, channelIndex: number) => {\n        if (!e.button) {\n            if (this._isSameFilterLR || this._currentChannelIndex !== channelIndex) {\n                if (this._isSameFilterLR) {\n                    this._isSameFilterLR = false;\n                    this._filter.channelIndex = 1 - this._currentChannelIndex;\n                    this._filter.updateFilter(false);\n                }\n\n                if (this._currentChannelIndex !== channelIndex) {\n                    this._currentChannelIndex = channelIndex;\n\n                    if (this._isActualChannelCurveNeeded) {\n                        this._filter.updateActualChannelCurve(channelIndex);\n                    }\n\n                    this._drawCurve();\n                }\n\n                this._checkMenu(this._mnuChL, channelIndex === 0);\n                this._checkMenu(this._mnuChR, channelIndex === 1);\n            }\n        }\n    }\n\n    private _mnuShowZonesClick = (e: MouseEvent) => {\n        if (!e.button) {\n            this._showZones = !this._showZones;\n            this._checkMenu(this._mnuShowZones, this._showZones);\n            this._drawCurve();\n        }\n    }\n\n    private _mnuEditZonesClick = (e: MouseEvent) => {\n        if (!e.button) {\n            this._editZones = !this._editZones;\n            this._canvas.classList[this._editZones ? 'add' : 'remove'](`${this._options.classNamespace}CNVZON`);\n            this._checkMenu(this._mnuEditZones, this._editZones);\n        }\n    }\n\n    private _mnuNormalizeCurvesClick = (e: MouseEvent) => {\n        if (!e.button) {\n            this._filter.isNormalized = !this._filter.isNormalized;\n            this._checkMenu(this._mnuNormalizeCurves, this._filter.isNormalized);\n\n            if (this._isActualChannelCurveNeeded) {\n                this._filter.updateActualChannelCurve(this._currentChannelIndex);\n                this._drawCurve();\n            }\n        }\n    }\n\n    private _mnuShowActualClick = (e: MouseEvent) => {\n        if (!e.button) {\n            this._isActualChannelCurveNeeded = !this._isActualChannelCurveNeeded;\n            this._checkMenu(this._mnuShowActual, this._isActualChannelCurveNeeded);\n\n            if (this._isActualChannelCurveNeeded) {\n                this._filter.updateActualChannelCurve(this._currentChannelIndex);\n            }\n\n            this._drawCurve();\n        }\n    }\n\n    private _btnMnuKeyDown = (e: KeyboardEvent) => {\n        if (keyPressed(e, 'ArrowUp', 'ArrowDown')) {\n            cancelEvent(e);\n            this._toggleMenu(keyPressed(e, 'ArrowUp'));\n\n            window.setTimeout(() => {\n                const items = this._mnu.querySelectorAll(`.${this._options.classNamespace!}MNUIT`);\n                (items[items.length - 1] as HTMLButtonElement).focus();\n            });\n        }\n    }\n\n    private _mnuKeyDown = (e: KeyboardEvent) => {\n\n        const moveFocus = (elem: Node, down: boolean) => {\n            const siblingProp = down ? 'nextSibling' : 'previousSibling';\n            let currentElem: Node | null = elem;\n\n            do {\n                currentElem = currentElem[siblingProp];\n\n                if (currentElem instanceof HTMLButtonElement &&\n                    currentElem.classList.contains(`${this._options.classNamespace!}MNUIT`)) {\n                    currentElem.focus();\n                    return true;\n                }\n            } while (currentElem);\n\n            return false;\n        };\n\n        if (keyPressed(e, 'ArrowUp', 'ArrowDown')) {\n            cancelEvent(e);\n            const down = keyPressed(e, 'ArrowDown');\n            if (!moveFocus(e.target as Node, down) && down) {\n                this._btnMnu.focus();\n            }\n        }\n    }\n\n    private _canvasMouseDown = (e: MouseEvent) => {\n        if (!e.button) {\n            if (!this._drawingMode) {\n                const { x, y } = elemCoords(this._canvas, e);\n\n                const normX = Math.floor(x / this._widthRatio());\n                const normY = y / this._heightRatio();\n\n                if (normX >= 0 && normX < this._filter.options.visibleBinCount!) {\n                    this._drawingMode = 1;\n                    if (this._editZones) {\n                        this._filter.changeZoneY(this._currentChannelIndex, normX, normY);\n                    }\n                    else {\n                        this._filter.channelCurves[this._currentChannelIndex][normX] = this._filter.clampY(normY);\n                        this._lastDrawX = normX;\n                        this._lastDrawY = normY;\n                    }\n\n                    this._drawCurve();\n\n                    if (this._canvas.setPointerCapture) {\n                        this._canvas.setPointerCapture((e as PointerEvent).pointerId);\n                    }\n                    else if (!(e as any).clonedFromTouch) {\n                        detachPointer(this._canvas, 'move', this._canvasMouseMove);\n                        detachPointer(this._canvas, 'up', this._canvasMouseUp);\n                        attachPointer(document, 'move', this._documentMouseMove, true);\n                        attachPointer(document, 'up', this._documentMouseUp, true);\n                    }\n                }\n            }\n\n            return cancelEvent(e);\n        }\n\n        return true;\n    }\n\n    private _canvasMouseUp = (e: MouseEvent) => {\n        if (this._drawingMode) {\n            this._drawingMode = 0;\n            this._filter.channelIndex = this._currentChannelIndex;\n            this._filter.updateFilter(false);\n\n            if (this._isActualChannelCurveNeeded) {\n                this._filter.updateActualChannelCurve(this._currentChannelIndex);\n            }\n\n            this._drawCurve();\n\n            if (this._canvas.releasePointerCapture) {\n                this._canvas.releasePointerCapture((e as PointerEvent).pointerId);\n            }\n            else if (!(e as any).clonedFromTouch) {\n                detachPointer(document, 'move', this._documentMouseMove, true);\n                detachPointer(document, 'up', this._documentMouseUp, true);\n                attachPointer(this._canvas, 'move', this._canvasMouseMove);\n                attachPointer(this._canvas, 'up', this._canvasMouseUp);\n            }\n        }\n    }\n\n    private _canvasMouseMove = (e: MouseEvent) => {\n        let curve = this._filter.channelCurves[this._currentChannelIndex];\n        const { x, y } = elemCoords(this._canvas, e);\n\n        if (this._drawingMode || (x >= 0 && x < this._canvas.width && y >= 0 && y < this._canvas.height)) {\n            let normX = Math.floor(x / this._widthRatio());\n            let normY = y / this._heightRatio();\n\n            if (normX < 0) {\n                normX = 0;\n            }\n            else if (normX >= this._filter.options.visibleBinCount!) {\n                normX = this._filter.options.visibleBinCount! - 1;\n            }\n\n            if (this._drawingMode) {\n                if (this._editZones) {\n                    this._filter.changeZoneY(this._currentChannelIndex, normX, normY);\n                }\n                else {\n                    if (Math.abs(normX - this._lastDrawX) > 1) {\n                        const delta = (normY - this._lastDrawY) / Math.abs(normX - this._lastDrawX);\n                        const inc = ((normX < this._lastDrawX) ? -1 : 1);\n                        normY = this._lastDrawY + delta;\n                        let count = Math.abs(normX - this._lastDrawX) - 1;\n\n                        for (normX = this._lastDrawX + inc; count > 0; normX += inc, count--) {\n                            curve[normX] = this._filter.clampY(normY);\n                            normY += delta;\n                        }\n                    }\n\n                    curve[normX] = this._filter.clampY(normY);\n                    this._lastDrawX = normX;\n                    this._lastDrawY = normY;\n                }\n                this._drawCurve();\n\n                if (this._options.updateFilterOnDrag) {\n                    // tslint:disable-next-line:no-magic-numbers\n                    throttledFunction(this._wrappedUpdateFilter, 150);\n                }\n            }\n            else if (this._isActualChannelCurveNeeded) {\n                curve = this._filter.actualChannelCurve;\n            }\n\n            this._setStatusBar(normX, normY, curve[normX]);\n\n            if (this._drawingMode) {\n                return cancelEvent(e);\n            }\n        }\n\n        return true;\n    }\n\n    private _windowResize = () => {\n        this._fixCanvasSize();\n    }\n\n    private _documentMouseMove = (e: MouseEvent) =>\n        this._canvasMouseMove(e);\n\n    private _documentMouseUp = (e: MouseEvent) => {\n        this._canvasMouseUp(e);\n    }\n\n    // virtual properties\n\n    get options(): ICanvasEqualizerOptions {\n        return deepAssign({}, defaultOptions, this._options);\n    }\n\n    get filterLength(): number {\n        return this._filter.filterLength;\n    }\n\n    set filterLength(newFilterLength: number) {\n        if (this._filter.filterLength !== newFilterLength) {\n            this._filter.filterLength = newFilterLength;\n\n            if (this._isActualChannelCurveNeeded) {\n                this._filter.updateActualChannelCurve(this._currentChannelIndex);\n            }\n\n            this._drawCurve();\n        }\n    }\n\n    get sampleRate(): number {\n        return this._filter.sampleRate;\n    }\n\n    set sampleRate(newSampleRate: number) {\n        if (this._filter.sampleRate !== newSampleRate) {\n            this._filter.sampleRate = newSampleRate;\n\n            if (this._isActualChannelCurveNeeded) {\n                this._filter.updateActualChannelCurve(this._currentChannelIndex);\n            }\n\n            this._drawCurve();\n        }\n    }\n\n    get audioContext(): AudioContext {\n        return this._filter.audioContext;\n    }\n\n    set audioContext(newAudioContext: AudioContext) {\n        if (this._filter.audioContext !== newAudioContext) {\n            this._filter.audioContext = newAudioContext;\n        }\n    }\n\n    get language(): string {\n        return this._l10n.language;\n    }\n\n    set language(language: string) {\n        this._l10n.language = language;\n    }\n\n    get visibleFrequencies(): Float32Array {\n        return this._filter.visibleFrequencies;\n    }\n\n    get convolver(): ConvolverNode {\n        return this._filter.convolver;\n    }\n}\n","/**\n * canvas-equalizer is distributed under the FreeBSD License\n *\n * Copyright (c) 2012-2017 Armando Meziat, Carlos Rafael Gimenes das Neves\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * The views and conclusions contained in the software and documentation are those\n * of the authors and should not be interpreted as representing official policies,\n * either expressed or implied, of the FreeBSD Project.\n *\n * https://github.com/radiojhero/canvas-equalizer\n */\n\nimport CanvasEqualizer from './CanvasEqualizer';\nexport default CanvasEqualizer;\n"],"names":["window","CustomEvent","e","MouseEvent","eventType","params","bubbles","cancelable","mouseEvent","document","createEvent","initMouseEvent","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","prototype","Event","attachPointer","detachPointer","wrap","func","wrapper","tag","elem","wrapperTag","unwrap","push","ret","filter","entry","i","PointerEvent","observable","eventName","targetFunction","capturePhase","addEventListener","removeEventListener","mappings","down","move","up","touch","changedTouches","pseudoMouse","clonedFromTouch","result","defaultPrevented","cancelEvent","forEach","mapping","runningFuncs","keyFix","Backspace","Escape","End","Home","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Delete","keyPressed","chr","Object","keys","indexOf","Array","isArray","key","keyCode","preventDefault","stopPropagation","throttledFunction","timeout","splice","setTimeout","requestAnimationFrame","addThrottledEvent","running","removeThrottledEvent","elemCoords","rect","getBoundingClientRect","x","left","y","top","FFTComplex","data","n","isign","nn","mmax","m","j","istep","wr","wpr","wpi","wi","theta","tempr","tempi","halfmmax","dj1","dj","Math","PI","sin","FFTReal","i1","i2","i3","i4","d1","d2","d3","d4","n4","c2","h1r","h1i","h2r","h2i","defaultOptions","validYRangeHeight","visibleBinCount","Equalizer","filterLength","audioContext","options","_validateFilterLength","_options","deepAssign","_filterLength","_sampleRate","sampleRate","_isNormalized","_binCount","_audioContext","_filterKernel","createBuffer","_tmp","Float32Array","_channelCurves","Int16Array","_actualChannelCurve","_channelIndex","_zeroChannelValueY","_maximumChannelValue","_minimumChannelValue","_minusInfiniteChannelValue","_maximumChannelValueY","_minimumChannelValueY","_visibleFrequencies","_equivalentZones","Uint16Array","eqz","ratio","length","freqSteps","firstFreqs","f","map","num","round","_equivalentZonesFrequencyCount","s","reset","_convolver","createConvolver","normalize","buffer","updateFilter","updateActualChannelCurve","maxY","minY","Infinity","_lerp","exp","LN10","magnitude","zcy","log","visibleBinIndex","z","vf","vbc","ez","ezc","channelIndex","visibleBinToZoneIndex","ii","cy","clampY","curve","convolverCallback","oldConvolver","sourceChannel","destinationChannel","src","getChannelData","dst","_updateBuffer","updateBothChannels","max","isSameFilterLR","valueCount","bw","filterLength2","M_HALF_PI_FFTLEN2","invMaxMag","repeat","Number","freq","mag","yToMagnitude","avg","avgCount","k","cos","_applyWindowAndComputeActualMagnitudes","copyFilter","oldChannelIndex","tmp","magnitudeToY","M","PI2_M","maxMag","rval","ival","sqrt","newFilterLength","newSampleRate","isNormalized","newAudioContext","disconnect","slice","newChannelIndex","Error","x0","y0","x1","y1","defaultLanguage","L10n","language","_language","loadLocale","defaultLocale","locale","_locales","locales","undefined","str","get","args","arg","replace","RegExp","toLocaleString","classNamespace","filterOptions","updateFilterOnDrag","CanvasEqualizer","frequency","compact","unit","_l10n","format","_filter","button","_toggleMenu","_mnuChBClick","_isSameFilterLR","_currentChannelIndex","_isActualChannelCurveNeeded","_drawCurve","_checkMenu","_mnuChBL","_mnuChBR","_mnuChLRClick","_mnuChL","_mnuChR","_showZones","_mnuShowZones","_editZones","_canvas","classList","_mnuEditZones","_mnuNormalizeCurves","_mnuShowActual","items","_mnu","querySelectorAll","focus","moveFocus","siblingProp","currentElem","HTMLButtonElement","contains","target","_btnMnu","_drawingMode","normX","floor","_widthRatio","normY","_heightRatio","changeZoneY","channelCurves","_lastDrawX","_lastDrawY","setPointerCapture","pointerId","_canvasMouseMove","_canvasMouseUp","_documentMouseMove","_documentMouseUp","releasePointerCapture","width","height","abs","delta","inc","count","_wrappedUpdateFilter","actualChannelCurve","_setStatusBar","_fixCanvasSize","placeholder","_ctx","createLabel","name","content","lbl","createElement","className","clsNS","innerHTML","createMenuSep","setAttribute","createMenuLabel","text","l","textContent","createMenuItem","checkable","checked","clickHandler","type","dataset","appendChild","createTextNode","blur","_element","test","navigator","userAgent","MSStream","add","getComputedStyle","direction","_isRTL","_stb","_canvasMouseDown","_windowResize","ctx","getContext","_lblCursor","_lblCurve","_lblFrequency","zeroChannelValueY","_btnMnuClick","_btnMnuKeyDown","_mnuKeyDown","_mnuChBLClick","_mnuChBRClick","_mnuChLClick","_mnuChRClick","_mnuShowZonesClick","_mnuEditZonesClick","_mnuNormalizeCurvesClick","_mnuShowActualClick","_rangeImage","clearTimeout","_barHideTimeout","dB","minimumFractionDigits","maximumFractionDigits","frequencyAndEquivalent","_formatFrequencyUnit","mnu","chk","inner","toggle","style","visibility","toString","call","firstChild","pixelRound","middleOffset","canvas","pixelRatio","devicePixelRatio","widthRatio","heightRatio","widthMinus1","fillStyle","fillRect","lineWidth","strokeStyle","beginPath","moveTo","lineTo","stroke","font","textAlign","fillText","equivalentZonesFrequencyCount","clientHeight","display","setTransform","createLinearGradient","addColorStop","label","span","querySelector","curveY","_setLabelParam","_formatDB","yToDB","_formatFrequency","visibleBinToFrequencyGroup","visibleFrequencies","convolver"],"mappings":"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"}